<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" dir="rtl" lang="fa-IR">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" dir="rtl" lang="fa-IR">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html dir="rtl" lang="fa-IR">
<!--<![endif]-->
    <head>
        <meta charset="utf-8"/>
<meta content="IE-edge,chrome=1" http-equiv="X-UA-Compatable"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="keywords" content="Google,Firebase,Android, ูุงุฑุจุณ,ุขููุฒุด"/>
<meta name="author" content="Sadra Isapanah Amlashi | ุตุฏุฑุง ุนุณ ูพูุงู ุงููุด"/>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script>
    (function(b,l,e,g,h,f){1!==parseInt(e.msDoNotTrack||b.doNotTrack||e.doNotTrack,10)&&b.addEventListener("load",function(){var r=(new Date).getTime();b.galite=b.galite||{};var m=new XMLHttpRequest,n="https://www.google-analytics.com/collect?cid="+(l.uid=l.uid||Math.random()+"."+Math.random())+"&v=1&tid="+galite.UA+"&dl="+f(h.location.href)+"&ul=en-us&de=UTF-8",a=function(b){var d="",c;for(c in b){if(void 0===b[c])return!1;d+=f(b[c])}return d},p={dt:[h.title],sd:[g.colorDepth,"-bit"],sr:[g.availHeight,
        "x",g.availWidth],vp:[innerWidth,"x",innerHeight],dr:[h.referrer]},k;for(k in p){var q=k+"="+a(p[k]);q&&(n+="&"+q)}a=function(b,d){var c="",a;for(a in d)c+="&"+a+"="+f(d[a]);return function(){var a=n+c+(galite.anonymizeIp?"&aip=1":"")+"&t="+f(b)+"&z="+(new Date).getTime();if(e.sendBeacon)e.sendBeacon(a);else try{m.open("GET",a,!1),m.send()}catch(t){(new Image).src=a}}};setTimeout(a("pageview",null),100);b.addEventListener("unload",a("timing",{utc:"JS Dependencies",utv:"unload",utt:(new Date).getTime()-
    r}))})})(window,localStorage,navigator,screen,document,encodeURIComponent);

    var galite = galite || {};
    galite.UA = 'UA-107934487-1'; // Insert your tracking code here
</script>

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@sadra_amlashi" />
<meta name="twitter:creator" content="@sadra_amlashi" />

<meta property="og:type" content="website" />
<meta property="og:locale" content="fa_IR" />
<meta property="og:url" content="isapanah.com/2017/how-to-fcm-android" />


<meta name="description" content="ุณูุงู! ูู ุตุฏุฑุง ุนุณ ูพูุงู ุงููุด ูุณุชู. ุชูุณุนู ุฏููุฏู ุงูพูฺฉุดู iOS ู Android.
"/>
<meta property="og:description" content="ุณูุงู! ูู ุตุฏุฑุง ุนุณ ูพูุงู ุงููุด ูุณุชู. ุชูุณุนู ุฏููุฏู ุงูพูฺฉุดู iOS ู Android.
"/>
<meta name="twitter:description" content="ุณูุงู! ูู ุตุฏุฑุง ุนุณ ูพูุงู ุงููุด ูุณุชู. ุชูุณุนู ุฏููุฏู ุงูพูฺฉุดู iOS ู Android.
"/>




<title>ูุงุฑุจุณ ฑ: ุณุฑูุณ Firebase Cloud Messaging | ุตุฏุฑุง ุงููุด</title>
<meta property="twitter:title" content="ูุงุฑุจุณ ฑ: ุณุฑูุณ Firebase Cloud Messaging | ุตุฏุฑุง ุงููุด"/>
<meta property="og:site_name" content="ูุงุฑุจุณ ฑ: ุณุฑูุณ Firebase Cloud Messaging | ุตุฏุฑุง ุงููุด"/>
<meta property="og:title" content="ูุงุฑุจุณ ฑ: ุณุฑูุณ Firebase Cloud Messaging | ุตุฏุฑุง ุงููุด"/>



<meta property="twitter:image" content="isapanah.com/assets/img/post/2017-10-24/fcm-cover.png" />
<meta property="og:image" content="isapanah.com/assets/img/post/2017-10-24/fcm-cover.png" />


<link rel="alternate" type="application/rss+xml" title="ฺฉุจุฑุฏ ุขุฒุงุฏ ยป Feed" href="/site-map.xml"/>
<link rel="alternative" href="/site-map.xml" title="ูุจูุงฺฏ ุตุฏุฑุง ุงููุด" type="application/atom+xml"/>
<link rel="short icon" type="image/x-icon" href="isapanah.com/assets/img/base/favicon.png"/>
<link rel="stylesheet" type="text/css" href="isapanah.com/assets/css/styles.css"/>
    </head>

    <body dir="rtl" lang="Farsi" >
        <!-- Header -->
<header class="header-rtl">
    <nav class="nav-wrap">
        <a href="/" class="nav-logo">ูุจูุงฺฏ ุตุฏุฑุง ุงููุด</a>
        <ul class="navigation">

            <li><a href="/">ุงุฏุฏุงุดุชโูุง</a></li>
            <li><a href="/list/items">ููุถูุนุงุช</a></li>
            <li><a href="/about">ุฏุฑุจุงุฑู</a></li>
            <li><a href="http://cv.isapanah.com/">ุฑุฒููู</a></li>
            <li><a href="https://sadra.github.io/english">English</a></li>

        </ul>
    </nav>
</header>
<!-- /Header -->

        <script>

    window.onscroll = function() {scrollFunction()};

    function scrollFunction() {
        document.getElementById("back-to-top").style.display = (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) ? "block" : "none";
    }

    function topFunction() {
        document.body.scrollTop = 0; // For Safari
        document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    }

</script>


<div class="content">

    <div class="blog-post-container">

        <div class="post-title-container">
            <h1 class="post-title">ูุงุฑุจุณ ฑ: ุณุฑูุณ Firebase Cloud Messaging</h1>
        </div>

        <div class="post_created">

            <div class="author_avatar">
                <img src="/assets/img/base/avatar.jpg" alt="ุตุฏุฑุง ุงููุด" id="avatar-img" />
            </div>

            <div class="post_info">
                <p> <a href="/about">ุตุฏุฑุง ุงููุด</a> </p>
                <small>ุชูุณุนู ุฏููุฏู</small><br/>
                <small>ุณูโุดูุจู 02 ุขุจุงู 1396</small>
            </div>

        </div>

        
        <div class="post-cover">
            <img src="isapanah.com/assets/img/post/2017-10-24/fcm-cover.png" alt="ูุงุฑุจุณ ฑ: ุณุฑูุณ Firebase Cloud Messaging">
        </div>
        

        <div class="post-content">
            <p>ุจูุง ุจุฑ ููู ฺฉู ุฏุฑ <a href="http://isapanah.com/2017/set-fire-into-the-problems-with-firebase">ูพุณุช ูุจู</a> ุฏุงุฏู ุจูุฏูุ ูุฎูุงู ุฏุฑ ฺฉ ูุฌููุนู ููุดุชู ุฏุฑุจุงุฑู ูพุงุฏู ุณุงุฒ ู ุงุณุชูุงุฏู ุงุฒ ุณุฑูุณโูุง ูุฎุชูู ูุงุฑุจุณ (ุชุง ุฌุง ฺฉู ุงู ุงูฺฉุงู ุจุฑุง ูุง ุฏุฑ ุงุฑุงู ูุฌูุฏ ุฏุงุดุชู ุจุงุดู) ุตุญุจุช ฺฉูู. ุดูุง ูโุชููุฏ ูพุณุชโูุง ุงู ุจูุงฺฏ ุฑุงุ ุฏุฑ ุฑุงุจุทู ุจุง ุณุฑูุณโูุง ูุงุฑุจุณุ ุงุฒ ุงู <a href="http://isapanah.com/tag/firebase">ููฺฉ ููุถูุน</a> ูุทุงูุนู ฺฉูุฏ.</p>

<p>ุงุฒููุฌุง ฺฉู ูุทุงูุจ ุฒุงุฏ ุจูุฏ ู ููฺูู ุฏุณุชู ุจูุฏโูุง ุชูุฏุฑุชูุ ุฏุฑ ุงุฏุงูู ููุฑุณุช ุงุฒ ฺฉู ูุทุงูุจ ู ุชุชุฑูุง ููุฌูุฏ ุฏุฑ ุงู ูพุณุช ุฑู ูุณุช ฺฉุฑุฏู. ุจุง ฺฉูฺฉ ุฑู ูุฑ ุชุชุฑ ุจู ุงูู ููุถูุน ูุฏุงุช ูโุดุฏ.</p>

<h2 id="ููุฑุณุช-ูุทุงูุจ">ููุฑุณุช ูุทุงูุจ</h2>

<ul>
  <li><a href="#introduction">ูุนุฑู Firebase Cloud Messaging</a></li>
  <li><a href="#fcm-account">ุงูุชุชุงุญ ุญุณุงุจ ู ุงุฌุงุฏ ฺฉ ูพุฑูฺู ุงูุฏุฑูุฏ ุฏุฑ ูุงุฑุจุณ</a></li>
  <li><a href="#basic-app-settings-for-fcm">ุชูุธูุงุช ุงููู ุงูพูฺฉุดู ุงูุฏุฑูุฏ</a></li>
  <li><a href="#node-service">ุณุฑูุณ ูพูุดโูุงุชูฺฉุดู ุจุง Node.js</a>
    <ul>
      <li><a href="#prepare-node-service">ุขูุงุฏูโุณุงุฒ ุณุฑูุณ Node.js</a></li>
      <li><a href="#using-nodejs">ุงุณุชูุงุฏู ุงุฒ ุณุฑูุณ Node.js</a>
        <ul>
          <li><a href="#node-notification">Notification</a></li>
          <li><a href="#node-data">Data</a></li>
          <li><a href="#node-combined-message">Combined Message</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#prepare-app-for-fcm">ุขูุงุฏู ุณุงุฒ ุงูพูฺฉุดู ุจุฑุง ุฏุฑุงูุช ูุงุชูฺฉุดู</a></li>
  <li><a href="#receiving-notification">ุฏุฑุงูุช ูุงุชูฺฉุดู</a>
    <ul>
      <li><a href="#send-and-receive-notification">ุงุฑุณุงู ู ุฏุฑุงูุช ูุงุชูฺฉุดู ุจุฑุง ฺฏุฑูู ุงุฒ ฺฉุงุฑุจุฑุงู</a></li>
      <li><a href="#user-topics">ุงุฑุณุงู ู ุฏุฑุงูุช ูุงุชูฺฉุดู ุจุฑ ุงุณุงุณ Topic ุง ููุถูุน ุฎุงุต</a></li>
      <li><a href="#send-message-to-all">ุงุฑุณุงู ูพุงู ุจุฑุง ูููโ ฺฉุงุฑุจุฑุงู</a></li>
      <li><a href="#other-settings">ุฏฺฏุฑ ุชูุธูุงุช ุงุฑุณุงู ูพุงู</a>
        <ul>
          <li><a href="#other-settings-priority">ุงูููุช Priority</a></li>
          <li><a href="#other-settings-time-to-alive">ุฒูุงู ุงุนุชุจุงุฑ ูพุงู timeToLive</a></li>
          <li><a href="#other-settings-collapse-key">ฺฉูุฏ ุฌุงฺฏุฒู ูพุงู collapse_key</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#conclusion">ูุชุฌูโฺฏุฑ</a></li>
</ul>

<h2 id="introduction">ูุนุฑู Firebase Cloud Messaging</h2>

<p>ูุงุฑุจุณ ฺฉูุงุฏ ูุณุฌูฺฏ ุง ุจู ุงุฎุชุตุงุฑ FCM ฺฉ ุงุฒ ุณุฑูุณโูุง ฺฉุงุฑุจุฑุฏ ูุงุฑุจุณ ูุณุช ฺฉู ุจู ุดูุง ฺฉูฺฉ ูฺฉูู ุชุง ุจุชููู ูพุงูโูุงุชูู ุฑู ุฏุฑ ฺฉูุชุฑู ุฒูุงู ู ุจุฏูู ูฺ ูุฒููโุง ุจู ุฏุณุช ฺฉุงุฑุจุฑุชูู ุฏุฑ ูพูุชูุฑูโูุง ูุฎุชูู ูุซู Android, iOS, WebApplication, C++, Unituy ุจุฑุณููุฏ.ูพุงู ุดูุง ูโุชููู ุจู ฺฉ ฺฉุงุฑุจุฑุ ุง ฺฏุฑูู ุงุฒ ฺฉุงุฑุจุฑุงูุ ุง ุจุฑ ุงุณุงุณ ู ุชุงูพฺฉ ู ููุถูุน ุงุฑุณุงู ุจุดู.
ุงุฌุงุฏ ฺฉ ุณุฑูุณ ู ุงุฑุณุงู ูพุงู ุจู ฺฉุงุฑุจุฑุงู ุดูุง ุฎู ุณุงุฏูโุณุช. ุงูู ุงุฒ ููู ุจุง ุงุถุงูู ฺฉุฑุฏู SDK ูุงุจุฑุจุณ ุจู ุงูพูฺฉุดูุชููุ ฺฉุงุฑุจุฑุงูุชูู ุฑู ุฏุฑ ุดุจฺฉู ฺฉูุงุฏ ูุงุจุฑุจุณ ุฑุฌุณุชุฑ ูโฺฉูุฏ. ู ุจุนุฏ ุฏุฑ ุณูุช ุณุฑูุฑุชูู ฺฉุณุฑ ฺฉุฏ ูโููุณุฏุ ุชุง ุชูุณุท ุงูู ุจุชููุฏ ูพุงูโูุงุชูู ุฑู ุจู ฺฉุงุฑุจุฑ ุง ฺฏุฑูู ุงุฒ ฺฉุงุฑุจุฑุงู ุงุฑุณุงู ฺฉูุฏ.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-13.png" alt="Firebase Cloud Messaging Console" /></p>

<p>ุดูุง ูโุชููุฏ ุฏูโูุงุ ูุฒุงุฑุงูุ ุง ุญุช ููููโูุง ูพุงู ุฏุฑ ุฑูุฒ ุจุฏูู ูุฒูู ู ุจุง ุฏูุช นตูช ุฏุฑ ฺฉูุชุฑ ุงุฒ ฒตฐููโุซุงูู ุจุฏูู ุชูุฌู ุจู ูพูุชูุฑู ฺฉุงุฑุจุฑ ุจู ุฏุณุชุดูู ุจุฑุณููุฏ. ุจู ููู ุณุงุฏฺฏุ ุจู ููู ุฎูุดูุฒฺฏ.๐</p>

<h2 id="fcm-account">ุงูุชุชุงุญ ุญุณุงุจ ู ุงุฌุงุฏ ฺฉ ูพุฑูฺู ุงูุฏุฑูุฏ ุฏุฑ ูุงุฑุจุณ</h2>

<p>ูพุณ ุงุฒ ุซุจุชโูุงู ู ูุฑูุฏ ุจู <a href="https://console.firebase.google.com/">ฺฉูุณูู ูุงุฑุจุณุ</a> ูโุจูุฏ ฺฉู ฺฉ ูพุฑูฺู ุขูุงุฏู ู ุงูุจุชู ุฏูู ุจู ุงุณู <strong><a href="https://console.firebase.google.com/project/fir-demo-project/overview">Firebase Demo Project</a></strong> ูุฌูุฏ ุฏุงุฑูุ ุงู ูพุฑูฺู ููุท ุฏุฑุญุงูุช View Only ู ุชููุง ุจุฑุง ุฏุฏู ุงูฺฉุงูุงุช ูุงุฑุจุณ ุงุฌุงุฏ ุดุฏู. ุจุฑุง ุงุฌุงุฏ ุงููู ูพุฑูฺู ููุท ฺฉุงูู ุฑู Add Project ฺฉูฺฉ ฺฉูุฏ.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-0.png" alt="Firebase Cloud Messaging Console" /></p>

<p>ุฏุฑ ูพูุฌุฑู ุจุงุฒ ุดุฏู ุงุณู ุจุฑุง ูพุฑูฺู (FirebaseApp) ูโููุณู. ุจูุชุฑู Country/region ุฑู ูููู UnitedStates ุจุงู ุจูููู. ุชูุฌู ฺฉูุฏ ฺฉู ุจุฑุง ุงุณุชูุงุฏู ุงุฒ Firebase ูุญุฏูุฏุช ูุฌูุฏ ุฏุงุฑู ู ููุท ูโุชููุฏ ณ ูพุฑูฺู ุงุฌุงุฏ ฺฉูุฏ! ุจุฑุง ุณุงุฎุชู ุจุดุชุฑ ุงุฒ ณ ูพุฑูฺู ุง ุจุงุฏ ุจุง ู ุญุณุงุจ ฺฉุงุฑุจุฑ ุฏฺฏู ูุงุฑุฏ ุจุดุฏ ุง ุงูฺฉู ูุฒูู ูพุฑุฏุงุฎุช ฺฉุฑุฏู ู ุธุฑูุช ฺฉูุณููุชูู ุฑู ุงูุฒุงุด ุจุฏุฏ.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-1.png" alt="Firebase Cloud Messaging Console" /></p>

<p>ูพุฑูฺู ุงููู ุงุฌุงุฏ ุดุฏู. ุญุงูุง ููุช ูุงุฑุฏ ูพูู ูโุดุฏ ณุชุง ฺฏุฒูู ุฏุงุฑุฏุ ูุง ุงุฒ ุจู ฺฏุฒููโูุง ูพุงูุ Android App ุฑู ุงูุชุฎุงุจ ูโฺฉูู.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-2.png" alt="Firebase Cloud Messaging Console" /></p>

<p>ุฎุจุ ุฏุฑ ุงู ูุฑุญูู ุจุงุฏ ูุดุฎุตุงุช ุงูพ ุฑู ุซุจุช ฺฉูู. ุงูู ุงุฒ ููู <strong>Package Address</strong> ุงูพ ุฑู ูุงุฑุฏ ูโฺฉููุ ู ุจุนุฏ ุฏุฑ <strong>App nickname</strong> ููููุทูุฑ ฺฉู ุงุฒ ุงุณูุด ูุดุฎุตู ู ุงุณู ุจุฑุง ูพุฑูฺููู ูโููุณู. ุฏุฑ ุจุฎุด <strong>SHA-1</strong> ูุชููุฏ ุงูุถุง ุงููุช ุงูพุชูู ุฑู ูุงุฑุฏ ฺฉูุฏุ ุฏุฑุตูุฑุช ฺฉู ุฎูุงุณุชุฏ ุงููุช ุจุดุชุฑ ูุญุงุธ ฺฉูุฏ ฺฉู ููุท ุฑู ูููู ูพฺฉุฌ ุจุง ูููู ุงูุถุง ฺฉุงุฑ ฺฉูู (ูุง ฺฉู ุฎุงู ูุฒุงุฑู ๐). ู ุจุนุฏุด ูู ฺฉู <strong>Register App</strong> ุฑู ูโุฒูู.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-3.png" alt="Firebase Cloud Messaging Console" /></p>

<p>ุฎุจ ูพุฑูฺู ุงุฌุงุฏ ุดุฏูุ ููุท ฺฉุงูู ูุงู <strong>google-service.json</strong> ุฑู ุฏุงูููุฏ ฺฉูู ู ุณูพุณ ุฑู Continue ฺฉูฺฉ ฺฉูู.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-4.png" alt="fcm-4" /></p>

<p>ุญุงูุง ุงูู ูุงู JSON ุฑูุ ูุซู ุชุตูุฑ ุฒุฑุ ุจู ูพุฑูฺู ุงูพูฺฉุดูููู (ฺฉู ุงูุฏูุงุฑู ุงุฒ ูุจู ุฏุฑุณุชู ฺฉุฑุฏู ุจูุฏู ุจุงุดุฏ) ุฏุฑ ูุณุฑ <code class="highlighter-rouge">../Project/app</code> ฺฉูพ ูโฺฉูู.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-5.png" alt="Firebase Cloud Messaging Console" /></p>

<p>ุฎุจ ูพุฑูฺููู ุงุฌุงุฏ ุดุฏู ู ฺฉุงุฑ ุชูููู.ุจุง ฺฉูฺฉ ุฑู ูพุฑูฺู ุงูพูฺฉุดู ุงุฌุงุฏ ุดุฏู ุฏุฑ ฺฉูุณูู ูุงุฑุจุณุ ูโุชููู ูุงุฑุฏ ูพูู ุจุดู ู ฺฉุงุฑูุง ฺฉู ูุงุฒูู ุฏุงุฑู ุฑู ุงูุฌุงู ุจุฏู.</p>

<h2 id="basic-app-settings-for-fcm">ุชูุธูุงุช ุงููู ุงูพูฺฉุดู ุงูุฏุฑูุฏ</h2>

<p>ูุจู ุดุฑูุน ูููโฺุฒ ุงู ุฑู ุจฺฏู ุจุง ูุฑุงุฌุนู ุจู <a href="https://github.com/sadra/FirebaseApp">ุงู ุฑูพู ฺฏุชูุงุจ</a>ุ ูโุชููุฏ ุจู ููููู ุงูพูฺฉุดู ฺฉู ุจุฑุง ููู ููุธูุฑ ุงุฌุงุฏ ฺฉุฑุฏู ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏ.</p>

<p>ุงูู ุงุฒ ููู ุฏุฑ ูุงู build.gradle ูุฑุจูุท ุจู <strong>project</strong>ุ ุฎุทูุท ุฒุฑ ุฑู ุงุตูุงุญ ู ุงุถุงูู ูฺฉูู.</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="c1">// Project-level build.gradle (&lt;project&gt;/build.gradle):</span>
<span class="n">buildscript</span> <span class="o">{</span>
  <span class="n">dependencies</span> <span class="o">{</span>
    <span class="c1">// Add this line</span>
    <span class="n">classpath</span> <span class="s1">'com.google.gms:google-services:3.1.0'</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>ู ุฏุฑ ูุงู build.gradle ูุฑุจูุท ุจู <strong>app.module</strong> ุฎุทูุท ุฒุฑ ุฑู ุฏุฑ ุงูุชูุง ูุญุชูุงุช ูุจู ุงุถุงูู ูโฺฉูู:</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="c1">// App-level build.gradle (&lt;project&gt;/&lt;app-module&gt;/build.gradle):</span>
<span class="o">...</span>
<span class="c1">// Add to the bottom of the file</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'com.google.gms.google-services'</span>
</code></pre>
</div>

<p>ู ููฺูู ูุงุฒูู ฺฉู ูุงุจุฑุฑ ูุง ูุฑุจูุท ุจู ูุงุฑุจุณ ุฑู ูู ุจู <strong>dependencies</strong> ุงุถุงูู ฺฉูู.</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="c1">// Project-level build.gradle (&lt;project&gt;/build.gradle):</span>
<span class="n">dependencies</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="c1">// Add this line</span>
  <span class="n">compile</span> <span class="s2">"com.google.firebase:firebase-core:11.+"</span>
  <span class="n">compile</span> <span class="s2">"com.google.firebase:firebase-messaging:11.+"</span>
<span class="o">}</span>
</code></pre>
</div>

<p>ู ุฏุฑ ููุงุช ุจุงุฏ ฺฏุฑุฏู ุฑู Sync ฺฉูู. ุจุนุฏ ุงุฒ ุงูฺฉู Gradle ฺฉุชุงุจุฎูููโูุง ูุฏ ูุธุฑุด ุฑู ุฏุฑุงูุช ู ุขูุงุฏู ุงุณุชูุงุฏู ุดุฏ ูุฑู ุณุฑุงุบ ูุฑุญูู ุจุนุฏ.</p>

<p>ุฎุจุ ุญุงูุง ุงูู ุงุฒ ููู ุฏุฑ ูุณุฑ ุงูพูฺฉุดู ฺฉ ุฏุงุฑฺฉุชูุฑ ุจู ุงุณู <code class="highlighter-rouge">PushNotification</code> ุงุฌุงุฏ ฺฉุฑุฏูุ ู ุฏุฑ ุงูู ฺฉ ฺฉูุงุณ ุจู ุงุณู <code class="highlighter-rouge">FCMInstanceIDService</code>ุ ฺฉู ุงุฒ <code class="highlighter-rouge">FirebaseInstanceIdService</code> ุงุฑุซโุจุฑ ูฺฉููุ ุงุฌุงุฏ ูฺฉูู. ุงู ฺฉูุงุณ ูุธูู ุณุงุฎุช ุชูฺฉู ู ุจุฑูุฒุฑุณุงู ุงูู ุฏุฑุตูุฑุช ฺฉู ุงฺฉุณูพุงุฑ ุดุฏู ุฑู ุจุฑ ุนูุฏู ุฏุงุฑู.</p>

<p>ููุช ฺฉู ฺฉุงุฑุจุฑ ฺฉ ุชูฺฉู ุฏุฑุงูุช ฺฉุฑุฏู ุง ุชูฺฉู ูุจู ู ุจุงุทู ู ุชูฺฉู ุฌุฏุฏ ุตุงุฏุฑ ุดุฏุ ุชุงุจุน <code class="highlighter-rouge">onTokenRefresh</code> ุฏุฑ ุงู ฺฉูุงุณ ุตุฏุง ูุฑุงุฎูู ูุดู. (<a href="https://github.com/sadra/FirebaseApp/blob/master/app/src/main/java/com/isapanah/firebase/PushNotification/FCMInstanceIDService.java">ูุดุงูุฏู ฺฉูุงุณ ุฏุฑ ฺฏุชูุงุจ</a>)</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FCMInstanceIDService</span> <span class="kd">extends</span> <span class="n">FirebaseInstanceIdService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTokenRefresh</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onTokenRefresh</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">refreshedToken</span> <span class="o">=</span> <span class="n">FirebaseInstanceId</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getToken</span><span class="o">();</span>
	<span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>ุฎุจ ุจุนุฏ ุงุฒ ุงูฺฉู ฺฉุงุฑุจุฑ ุชูฺฉู ุฏุฑุงูุช ฺฉุฑุฏ ูุชููู ุงุฒ ุณุฑูุณ FCM ุงุณุชูุงุฏู ฺฉููุ ูพุณ ูุง ูู ุจุงุฏ ู ฺฉูุงุณ ุงุฌุงุฏ ฺฉูู ฺฉู ูพุงูโูุง ุฏุฑุงูุช FCM ุฑู ูุฏุฑุช ฺฉูู. ุจุฑุง ุงู ููุธูุฑ ฺฉูุงุณ ุจู ูุงู <code class="highlighter-rouge">FCMService</code> ุงุฌุงุฏ ฺฉุฑุฏู ู ุงูู ุฑู  <strong>extend</strong> ูโฺฉูู ุงุฒ <code class="highlighter-rouge">FirebaseMessagingService</code>.</p>

<p>ุฏุฑ ุงู ฺฉูุงุณ ูุง ูโุชููู ุจุง ุงุณุชูุงุฏู ุงุฒ ุชุงุจุน <code class="highlighter-rouge">onMessageReceived</code> ุฏุฑ ููฺฏุงู ุฏุฑุงูุช ูพุงู ุงุฒ FCM ุงูู ุฑู ูุฏุฑุช ฺฉุฑุฏู ู ูุฑ ุจูุง ฺฉู ูุฎูุงู ุณุฑุด ุจุงุฑู ๐ (<a href="https://github.com/sadra/FirebaseApp/blob/master/app/src/main/java/com/isapanah/firebase/PushNotification/FCMService.java">ูุดุงูุฏู ฺฉูุงุณ ุฏุฑ ฺฏุชูุงุจ</a>)</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FCMService</span> <span class="kd">extends</span> <span class="n">FirebaseMessagingService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessageReceived</span><span class="o">(</span><span class="n">RemoteMessage</span> <span class="n">remoteMessage</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"FCM"</span><span class="o">,</span> <span class="s">"New notification from: "</span> <span class="o">+</span> <span class="n">remoteMessage</span><span class="o">.</span><span class="na">getFrom</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>ุจุนุฏ ุงุฒ ุงูฺฉู ุฏู ฺฉูุงุณ <strong>FCMInstanceIDService</strong> ู <strong>FCMService</strong> ุฑู ุขูุงุฏู ฺฉุฑุฏูุ ููุชุดู ฺฉู ุงูููุงุฑู ุฏุฑ <code class="highlighter-rouge">AndroidManifest</code> ูู ุจู ุนููุงู ุณุฑูุณ ุฑูุฏุงุฏโูุง <code class="highlighter-rouge">INSTANCE_ID_EVENT</code> ู <code class="highlighter-rouge">MESSAGING_EVENT</code> ูุนุฑู ฺฉูู.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- ADD this lines before &lt;/application&gt; close tag --&gt;</span>
<span class="nt">&lt;service</span>
    <span class="na">android:name=</span><span class="s">".PushNotification.FCMInstanceIDService"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.google.firebase.INSTANCE_ID_EVENT"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/service&gt;</span>

<span class="nt">&lt;service</span>
    <span class="na">android:name=</span><span class="s">".PushNotification.FCMService"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.google.firebase.MESSAGING_EVENT"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/service&gt;</span>
</code></pre>
</div>

<p>ุฎุจ ุฏุฑ ูููุฌุง ูู ูุชููู ุขฺฉูู ูุงุชูฺฉุดู ู ุฑูฺฏ ูพุดโุฒููู ุงูู ุฑู ุฏุฑ ูููุณุช ูุดุฎุต ฺฉูู. (<a href="https://github.com/sadra/FirebaseApp/blob/master/app/src/main/AndroidManifest.xml">ูุดุงูุฏู AndroidManifest ุฏุฑ ฺฏุชูุงุจ</a>)</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- ADD this lines before &lt;/application&gt; close tag --&gt;</span>
<span class="nt">&lt;meta-data</span>
    <span class="na">android:name=</span><span class="s">"com.google.firebase.messaging.default_notification_icon"</span>
    <span class="na">android:resource=</span><span class="s">"@mipmap/ic_launcher"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;meta-data</span>
    <span class="na">android:name=</span><span class="s">"com.google.firebase.messaging.default_notification_color"</span>
    <span class="na">android:resource=</span><span class="s">"@color/colorPrimary"</span> <span class="nt">/&gt;</span>
</code></pre>
</div>

<p>ุงูุจุชู ุงู ุฏู ูุชุง ุฏุชุง ููุท ุจุฑุง ูุฑฺู ูุง ุงูุฏุฑูุฏ 21 ุนู Lolipop ุจู ุจุงูุง ฺฉุงุฑ ูฺฉูู!</p>

<h2 id="node-service">ุณุฑูุณ ูพูุดโูุงุชูฺฉุดู ุจุง Node.js</h2>

<p>ุฎุจ ูุจู ุงุฒ ุงูฺฉู ุจุฑู ุณุฑุงุบ ุชูุธูุงุช ุจุนุฏ ู ุขูุงุฏูโุณุงุฒ ุงูพูฺฉุดูุ ูุงุฒูู ฺฉู ู ุณุฑูุณ ูู ูุฑุงูู ฺฉูู ุจุฑุง ุงูฺฉู ุจุชููู ุจุง ุงุณุชูุงุฏู ุงุฒ API ฺฏูฺฏู ุจุฑุง ุชูููโูุง ููุฑุงู ฺฉู ุงูพูฺฉุดู ูุงุฑู ูุตุจ ุฏุงุฑูุฏ ูพุงู ุงุฑุณุงู ฺฉูู.</p>

<h3 id="prepare-node-service">ุขูุงุฏู ุณุงุฒ ุณุฑูุณ Node.js</h3>

<p>ูู ุจุฑุง ุงูฺฉู ุดูุง ุฏุฑฺฏุฑ ฺฉุงุฑูุง ูุฑุจูุท ุจู ุชูู ุงู ุณุฑูุณ ูุดุฏ ุงุฒ ูุจู ุงูู ุฑู ุจุง Node.js ููุดุชู ู ุฏุฑ <a href="https://github.com/sadra/FCMPushNotification">ุฑูพูุฒุชูุฑ ฺฏุชูุงุจ</a> ูุฑุงุฑ ุฏุงุฏู.
ููุท ฺฉุงูู ุชุฑููุงู ุฑู ุจุงุฒ ฺฉุฑุฏู ู ุจุง ุฏุณุชูุฑ <code class="highlighter-rouge">git clone REPO_ADDRESS</code> ุงูู ุฑู ุฏุฑ ุฌุง ฺฉู ูุฎูุงูุฏ ฺฉููู ุจฺฏุฑุฏ.
ุจุนุฏ ุงุฒ ฺฉููู ฺฏุฑูุชู (ุจุง ุงุณุชูุงุฏู ุงุฒ ุชุฑููุงู ุง CMD) ูุงุฑุฏ ุฏุงุฑฺฉุชูุฑ ุงุตู ูพุฑูฺู node ุดุฏู ู ุฏุณุชูุฑ <code class="highlighter-rouge">npm install</code> ุฑู ุงุฌุฑุง ฺฉูุฏ ุชุง ูพฺฉุฌโูุง ููุฑุฏ ูุงุฒ ุฑู ุฏุงูููุฏ ฺฉูู. ุฏุฑ ููุงุช ุจุนุฏ ุงุฒ ูุตุจ ุดุฏู ูพฺฉุฌ ูุง ููุท ุจุง ุงุฌุฑุง ุฏุณุชูุฑ <code class="highlighter-rouge">npm start</code> ุณุฑูุณ ุขูุงุฏู ุงุณุชูุงุฏู ุณุช ู ุจุง ุขุฏุฑุณ <code class="highlighter-rouge">http://localhost:3000</code> ุฏุฑ ุฏุณุชุฑุณ ุดูุงุณุช. ูพุณ:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>โ  git clone git@github.com:sadra/FCMPushNotification.git
โ  <span class="nb">cd</span> ~/FCMPushNotification
โ  FCMPushNotification git:<span class="o">(</span>master<span class="o">)</span> โ npm install
โ  FCMPushNotification git:<span class="o">(</span>master<span class="o">)</span> โ npm start
</code></pre>
</div>

<p>ุงฺฏุฑ ูุงู <code class="highlighter-rouge">app.js</code> ุฑู ุฏุฑ ุงู ูพุฑูฺู ุจุงุฒ ฺฉูุฏ ฺูุฏ ฺฉูุฏ ูุฌูุฏ ุฏุงุฑูุ ุงูู ุงุฒ ููู ูุงุฒูู ฺฉู ฺฉูุฏ ุงููุช ุงุณุชูุงุฏู ุงุฒ FCM ุฑู ุงุฒ ฺฉูุณูู ูุงุฑุจุณ ูพุฑูฺุชูู ุฏุฑุงูุช ฺฉุฑุฏู ู ุจุฌุง API_KEY ูุฑุงุฑ ุจุฏุฏ. ุจุฑุง ุฏุฑุงูุช API Key ุจู ฺฉูุณูู ูุงุฑุจุณ ูุฑุงุฌุนู ฺฉุฑุฏูุ ุฑู ูพุฑูฺู FirebaseAppุ ู ุจุนุฏ ูู ุฑู ููู ูพุฑูฺู ุงูพ ุงูุฏุฑูุฏ Firebase ฺฉูฺฉ ฺฉูุฏ ู ุจู Settings ุงู ุงูพ ุจุฑุฏ.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-6.png" alt="Firebase Cloud Messaging Console" /></p>

<p>ุฏุฑ ูพูุฌุฑู ุจุงุฒ ุดุฏู ุจู ุณุฑุจุฑฺฏ Cloud Messaging ุฑูุชู ฺฉุฏ Server Key ุฑู ฺฉูพ ฺฉุฑุฏู ู ุฏุฑ ูพุฑูฺู Node.js ุจุฌุง <code class="highlighter-rouge">API_KEY</code> ูุฑุงุฑ ุจุฏุฏ.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-7.png" alt="Firebase Cloud Messaging Console" /></p>

<p>ุฏุฑ ุจุนุฏ ุงุฒ ุงูู ูู ูุงุฒูู ุชูฺฉู ุงูู ุงูพูฺฉุดู ุจุฑุง ุชุณุช ุงุณุชูุงุฏู ูโฺฉูุฏ ุฑู ุจุฑุง <code class="highlighter-rouge">USER_KEY</code> ููุฏุงุฑโุฏู ฺฉูุฏ. (ุงู ฺฏุฒูู ุงูุชุฎุงุจุณุช ู ุงูุฒุงู ูุฏุงุฑูุ ุงูุง ุจูุชุฑู ฺฉ ูุฒุฑ ุชุณุช ุฏุงุดุชู ุจุงุดู ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุฎุทุงูุง ุงูุณุงู ู ุชุณุช ุงูพ.)</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">/// PATH: ../FCMPushNotification/app.js</span>
<span class="kd">let</span> <span class="nx">API_KEY</span> <span class="o">=</span> <span class="s2">"key="</span><span class="o">+</span><span class="s2">"AAAAr_E2NCM:APA91bEgmznGj0R5PpRg1ek7GKeMmpADJ5Bj..."</span><span class="p">;</span> <span class="c1">// Your FCM server API key</span>
<span class="kd">let</span> <span class="nx">USER_KEY</span> <span class="o">=</span> <span class="s2">"eWRAtJC2zTs:APA91bEZ_zgxYiEWFaxpHI_wMDO5IApmEt..."</span><span class="p">;</span> <span class="c1">// User FCM Token ID</span>
</code></pre>
</div>

<h3 id="using-nodejs">ุงุณุชูุงุฏู ุงุฒ ุณุฑูุณ ูพูุด Node.js</h3>

<p>ูุจู ุงุฒ ุงูฺฉู ุจู ุชูุถุญุงุช ุงุณุชูุงุฏู ุงุฒ ุงู ุณุฑูุณ ุจูพุฑุฏุงุฒู ูุงุฒูู ุจุฏููุฏ ฺฉู ูุง ฺูุฏ ููุน ูพุงู ูโุชููู ุงุฑุณุงู ฺฉูู. ูุทุงุจู ุจุง ูุณุชูุฏุงุช FCM ูุง ููุท ฒ ููุน ูพุงู ุฏุงุฑู: <strong>Notification</strong> ู <strong>Data</strong>. ุงูุง ูุฑฺฉุฏูู ฺ ูุณุชู ู ฺู ูุฑู ุจุงูู ุฏุงุฑูุ</p>

<ul>
  <li>
    <h4 id="node-notification">Notification</h4>

    <p>ุงู ููุน ูพุงู ููุท ฒ ุจุฎุด ุฏุงุฑูุ <code class="highlighter-rouge">title</code> ู <code class="highlighter-rouge">body</code>. ุดูุง ููุท ูโุชููุฏ ู ูพุงู ุณุงุฏู ุจุง ฺฉ ุนููุงู ู ฺฉ ูุชู ุงุฑุณุงู ฺฉูุฏ ฺฉู ูุญุฏูุฏุช ฺฉุงุฑฺฉุชุฑ ูู ุฏุงุฑุฏ. ุณุงุฎุชุงุฑ ุงู ูพุงู ุจู ุงู ุดฺฉูู:</p>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">notification</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">title</span><span class="p">:</span> <span class="s2">"Title of the notification message"</span><span class="p">,</span>
      <span class="na">body</span><span class="p">:</span> <span class="s2">"This is Body of the notification message."</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<ul>
  <li>
    <h4 id="node-data">Data</h4>

    <p>ุงูุง ุงฺฏุฑ ูพุงู ุดูุง ุงุฒ ููุน Data ุจุงุดูุ ุดูุง ุงู ุงูฺฉุงู ุฑู ุฏุงุฑุฏ ฺฉู ูพุงูุชูู ุฑู ุจุตูุฑุช JSON ู ุจุง ูุฑ ุณุงุฎุชุงุฑ ู ููุงุฏุฑ ฺฉู ุฏูุณุช ุฏุงุฑุฏ ุงุฑุณุงู ฺฉูุฏุ ุจุฑุง ูุซุงู:</p>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">score</span><span class="p">:</span> <span class="s2">"850"</span><span class="p">,</span>
      <span class="na">time</span><span class="p">:</span> <span class="s2">"2:45"</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<ul>
  <li>
    <h4 id="node-combined-message">Combined Message</h4>

    <p>ุฌุงูุจ ุงูุฌุงุณุช ฺฉู ุดูุง ูโุชููุฏ ูุฑุฏู ููุน Notification ู Data ุฑู ุจุงูู ฺฉุฌุง ุจูุฑุณุชุฏ. ุจุฑุง ูุซุงู ู ูพุงู ูุงุชูฺฉุดู ุฏุงุฑุฏ ฺฉู ูุฎูุงูุฏ ูู ุจู ฺฉุงุฑุจุฑ ูพุงู ูุดูู ุจุฏู ูู ููุฏุงุฑ ุฑู ุฏุฑ ุฏุชุงุจุณ ุงูพูฺฉุดู ุชุบุฑ ุจุฏู:</p>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">notification</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">title</span><span class="p">:</span> <span class="s2">"$GOOG up 1.43% on the day"</span><span class="p">,</span>
    <span class="na">body</span><span class="p">:</span> <span class="s2">"$GOOG gained 11.80 points to close at 835.67, up 1.43% on the day."</span>
  <span class="p">},</span>
  <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">stock</span><span class="p">:</span> <span class="s2">"GOOG"</span><span class="p">,</span>
    <span class="na">open</span><span class="p">:</span> <span class="mf">829.62</span><span class="p">,</span>
    <span class="na">close</span><span class="p">:</span> <span class="s2">"635.67"</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>ูู ุฏุฑ ุงู ูพุฑูฺู ุจุง ุงุณุชูุงุฏู ุงุฒ Express ู ุจุฑ ูพุงู REST API ฺฉุณุฑ Route ุขูุงุฏู ฺฉุฑุฏู ุชุง ุดูุง ุจุชููุฏ ุจุฏูู ุฏุฑุฏุณุฑ ูพุงูโูุงุชูู ุฑู ุงุฑุณุงู ฺฉูุฏ. ูุง 4 ุฑูุช ุฏุงุฑูุ ฺฉู ูุฑฺฉุฏูู ุจู ุชุฑุชุจ ูุธุงู ุฒุฑ ุฑู ุจุฑุนูุฏู ุฏุงุฑูุฏ:</p>

<ul>
  <li>ุจุง ุงู ุฑูุช ูโุชููุฏ ฺฉ ูพุงู ุจู ุตูุฑุช notification ุณุงุฏู ุงุฑุณุงู ฺฉูุฏ.</li>
</ul>

<div class="language-http highlighter-rouge"><pre class="highlight"><code><span class="err">POST /send/notification
</span></code></pre>
</div>

<ul>
  <li>ุจุง ุงู ุฑูุช ูโุชููุฏ ฺฉ ูพุงู data ุณุงุฏู ุงุฑุณุงู ฺฉูุฏ.</li>
</ul>

<div class="language-http highlighter-rouge"><pre class="highlight"><code><span class="err">POST /send/data-notification
</span></code></pre>
</div>

<ul>
  <li>ุชูุณุท ุงู ุฑูุช ฺฉ ูพุงู data ุจุฑุง ฺฉ ุฏุณุชู ุฎุงุต ุงุฒ ฺฉุงุฑุจุฑุงูููู ฺฉู VIP ูุณุชูุฏ ุงุฑุณุงู ูโฺฉูู (ุฏุฑ ุงุฏุงูู ุชูุถุญ ุฎูุงูู ุฏุงุฏ).</li>
</ul>

<div class="language-http highlighter-rouge"><pre class="highlight"><code><span class="err">POST /send/data-notification/VIP
</span></code></pre>
</div>

<ul>
  <li>ุชูุณุท ุงู ุฑูุช ูู ฺฉ ูพุงู combined ุจุฑุง ฺฉ ุฏุณุชู ุฎุงุต ุงุฒ ฺฉุงุฑุจุฑุงูููู ฺฉู VIP ูุณุชูุฏ ุงุฑุณุงู ูโฺฉูู.</li>
</ul>

<div class="language-http highlighter-rouge"><pre class="highlight"><code><span class="err">POST /send/combined-notification/VIP
</span></code></pre>
</div>

<p>ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุงู ุฑูุชโูุง ูโุชููุฏ ุงุฒ ุฏุณุชูุฑ CURL ุฏุฑ ุชุฑููุงู ฺฉูฺฉ ุจฺฏุฑุฏ. ุงูุง ูู ุชูุตู ูฺฉูู ุงุฒ <a href="https://www.getpostman.com/">Postman</a> ุจุฑุง ุฑฺฉูุฆุณุช ุฒุฏู ุงุณุชูุงุฏู ฺฉูุฏ. ฺฉุงูฺฉุดู ุงู ุฑฺฉูุฆุณุชโูุงุฑู ูู ูู ุงุฒ ูุจู ุจุฑุง ุดูุง ุขูุงุฏู ฺฉุฑุฏู ู ุฏุฑ ูพุฑูฺู ูุฑุงุฑ ุฏุงุฏู. ููุท ฺฉุงูู ุงุฒ ุฏุงุฎู ุฏุงุฑฺฉุชูุฑ ูพุฑูฺูุ ุฏุฑ ูููุฏุฑ postman-export ู ุง <a href="https://github.com/sadra/FCMPushNotification/blob/master/postman-export/Firebase%20Push%20Notification.postman_collection">ุงุฒ ุงูุฌุง ุฏุฑ ุฑูพู ฺฏุชูุงุจ</a> ุงูู ุฑู ุฏุฑุงูุช ฺฉุฑุฏู ู ุจู <a href="https://www.getpostman.com/docs/postman/collections/data_formats">Postmanุชูู import</a> ฺฉูุฏ. ู ุง <a href="https://www.getpostman.com/collections/3776ad8010e1b7ae2c6e">ุงุฒ ุงูุฌุง</a> ุจุทูุฑ ูุณุชูู ุจู ูพุณุชโููุชูู ุงุถุงูู ฺฉูุฏ.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-8.png" alt="Firebase Cloud Messaging Console" /></p>

<p>ุญุงูุง ุชููุง ฺฉุงุฑ ฺฉู ูุงุฒูู ุงูุฌุงู ุจุฏุฏ ุงูู ฺฉู ุณุฑูุณ ุฑู ุจุง <code class="highlighter-rouge">npm start</code> ุงุฌุฑุง ฺฉุฑุฏู ู ุจุง Postman ุฑฺฉูุฆุณุชโูุงุชูู ุฑู ุงุฑุณุงู ฺฉูุฏ. ุฎุจ ฺฉุงุฑููู ุจุง ุณุฑูุณ Node.js ู Postman ุชุง ุงูุฌุง ุชููู ุดุฏ.</p>

<h2 id="prepare-app-for-fcm">ุขูุงุฏู ุณุงุฒ ุงูพูฺฉุดู ุจุฑุง ุฏุฑุงูุช ูุงุชูฺฉุดู</h2>

<p>ุฎุจ ุฑุณุฏู ุจู ุงุตู ูุงุฌุฑุงุ ุญุงูุง ูู ุงูพูฺฉุดู ุขูุงุฏู ุงุณุช ูู ุณุฑูุณ Node.js. ุงฺฏู ูพุงู ุฑู ุงุฑุณุงู ฺฉูุฏ ุงูพูฺฉุดู ุจุฏูู ูฺ ูุดฺฉู ุงูู ุฑู ุฏุฑุงูุช ูโฺฉูู ุงูุง ฺุฒ ูุดูู ููุฏูุ ฺูู ูุง ูููุฒ ุจูุด ูฺฏูุชู ุจุง ูพุงู ฺฉู ุฏุฑุงูุช ฺฉุฑุฏู ฺู ฺฉุงุฑ ุจฺฉูู.</p>

<h3 id="receiving-notification">ุฏุฑุงูุช ูุงุชูฺฉุดู</h3>

<p>ููููุทูุฑ ฺฉู ุฏุฑ ูุณูุช ูุจู ฺฏูุชู ูพุงูโูุง ุชูุณุท ฺฉูุงุณ <code class="highlighter-rouge">FCMService</code> ุฏุฑ ุชุงุจุน <code class="highlighter-rouge">onMessageReceived</code> ูโุชููู ุฏุฑุงูุช ฺฉูู. ู ููฺูู ฺฏูุชู ฺฉู ฒููุน ูพุงู ุฏุงุฑูุ ฺฉู ุง notification ูุณุชูุฏ ุง data ( ู ุง ูุฑุฏู ุจุงูู ). ุจุฑุง ุฏุฑุงูุช ูพุงู notification ุจุงุฏ ุชุงุจุน <code class="highlighter-rouge">getNotification</code> ู ุจุฑุง data ุงุฒ ุชุงุจุน <code class="highlighter-rouge">getData</code> ุงุณุชูุงุฏู ูโฺฉูู.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessageReceived</span><span class="o">(</span><span class="n">RemoteMessage</span> <span class="n">remoteMessage</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"New notification from: "</span> <span class="o">+</span> <span class="n">remoteMessage</span><span class="o">.</span><span class="na">getFrom</span><span class="o">());</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">remoteMessage</span><span class="o">.</span><span class="na">getNotification</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"Notification message: "</span> <span class="o">+</span> <span class="n">remoteMessage</span><span class="o">.</span><span class="na">getNotification</span><span class="o">());</span>
        <span class="n">notificationMessageReceived</span><span class="o">(</span><span class="n">remoteMessage</span><span class="o">.</span><span class="na">getNotification</span><span class="o">().</span><span class="na">getTitle</span><span class="o">(),</span> <span class="n">remoteMessage</span><span class="o">.</span><span class="na">getNotification</span><span class="o">().</span><span class="na">getBody</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">remoteMessage</span><span class="o">.</span><span class="na">getData</span><span class="o">().</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"Data Payload: "</span> <span class="o">+</span> <span class="n">remoteMessage</span><span class="o">.</span><span class="na">getData</span><span class="o">());</span>
        <span class="n">dataMessageReceived</span><span class="o">(</span><span class="n">remoteMessage</span><span class="o">.</span><span class="na">getData</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<p>ุงฺฏุฑ ูพุงู ฺฉู ุงุฑุณุงู ุดุฏู ุงุฒ ููุน <strong>notification</strong> ุจูุฏุ ููุท ฺฉุงูู title ู body ุฑู ฺฏุฑูุชู ู ุจุง ุงุณุชูุงุฏู ุงุฒ <code class="highlighter-rouge">NotificationCompat</code> ุงูู ุฑู ูุดูู ุจุฏู.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">notificationMessageReceived</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">body</span><span class="o">){</span>

    <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span> <span class="n">notificationBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="n">title</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setAutoCancel</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="n">getNotificationIcon</span><span class="o">())</span>
            <span class="o">.</span><span class="na">setLargeIcon</span><span class="o">(</span><span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">ic_launcher</span><span class="o">))</span>
            <span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">ContextCompat</span><span class="o">.</span><span class="na">getColor</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorPrimary</span><span class="o">));</span>

    <span class="n">NotificationManager</span> <span class="n">notificationManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">NotificationManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">NOTIFICATION_SERVICE</span><span class="o">);</span>
    <span class="n">notificationManager</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="n">getNotify</span><span class="o">(),</span> <span class="n">notificationBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>

<span class="o">}</span>
</code></pre>
</div>

<p>ู ุงฺฏุฑ ูพุงู ุงุฒ ููุน <strong>data</strong> ุจูุฏุ ุจุง ฺฉูฺฉ <code class="highlighter-rouge">getData</code> ูุญุชู ูพุงู ุฑู ฺฏุฑูุชูุ ุจู ูุงู <strong>JSONObject</strong> ุชุจุฏู ฺฉุฑุฏู ู ุงุฒุด ุงุณุชูุงุฏู ูโฺฉูู.</p>

<p>ูู ุฏุฑ ุงู ูพุฑูฺู ููููู ุจุฑุง ูพุงู data ฺฉ ุขุจุฌฺฉุช ุจูุงู <code class="highlighter-rouge">type</code> ุชุนุฑู ฺฉุฑุฏู. ู ุจุฑ ุงุณุงุณ <strong>type</strong> ูพุงูู ุฏุชุงุ ูุดุฎุต ูฺฉูู ฺฉู ฺู ุฑูุชุงุฑ ุจุงุฏ ุงุฒ ุงูพูฺฉุดู ุณุฑ ุจุฒูู.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">dataMessageReceived</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Map</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;</span> <span class="n">body</span><span class="o">)</span> <span class="o">{</span>

    <span class="k">try</span><span class="o">{</span>
        <span class="n">JSONObject</span> <span class="n">bodyObjects</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>

        <span class="k">if</span><span class="o">(</span><span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"type"</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="s">"banner"</span><span class="o">)){</span>
            <span class="n">showNotificationWithBanner</span><span class="o">(</span> <span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"title"</span><span class="o">),</span> <span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"message"</span><span class="o">),</span> <span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"banner_url"</span><span class="o">)</span>  <span class="o">);</span>
        <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"type"</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="s">"dialog_message"</span><span class="o">)){</span>
            <span class="n">broadcastTheMessage</span><span class="o">(</span><span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"title"</span><span class="o">),</span> <span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"message"</span><span class="o">));</span>
        <span class="o">}</span>

    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span> <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"There is a problem"</span><span class="o">,</span><span class="s">"Exception: "</span><span class="o">+</span><span class="n">e</span><span class="o">);</span> <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<p>ุงฺฏู type ุจุฑุงุจุฑ banner ุจุงุดูุ ุงูู ูพุงู ุฑู ุฏุฑุงูุช ฺฉุฑุฏูุ ู ุจุนุฏ ู <code class="highlighter-rouge">BigPictureStyle</code> ุจุฑุง <code class="highlighter-rouge">NotificationCompat</code> ูุณุงุฒูุ ู ุฏุฑ ููุงุช ุงูู ุฑู ุจู <code class="highlighter-rouge">NotificationCompat.Builder</code> ูุณุจุชโุฏู ูโฺฉูู.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">showNotificationWithBanner</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">String</span> <span class="n">bannerURL</span><span class="o">){</span>

    <span class="c1">//Style for showing notification With Banner</span>
    <span class="n">Bitmap</span> <span class="n">remote_picture</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">gray_banner</span><span class="o">);</span>
    <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">BigPictureStyle</span> <span class="n">notiStyle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">BigPictureStyle</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">remote_picture</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeStream</span><span class="o">((</span><span class="n">InputStream</span><span class="o">)</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">bannerURL</span><span class="o">).</span><span class="na">getContent</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="n">notiStyle</span><span class="o">.</span><span class="na">bigPicture</span><span class="o">(</span><span class="n">remote_picture</span><span class="o">);</span>

    <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span> <span class="n">notificationBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="n">title</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setAutoCancel</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="n">getNotificationIcon</span><span class="o">())</span>
            <span class="o">.</span><span class="na">setLargeIcon</span><span class="o">(</span><span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">ic_launcher</span><span class="o">))</span>
            <span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">ContextCompat</span><span class="o">.</span><span class="na">getColor</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorPrimary</span><span class="o">))</span>
            <span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">notiStyle</span><span class="o">);</span>

    <span class="n">NotificationManager</span> <span class="n">notificationManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">NotificationManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">NOTIFICATION_SERVICE</span><span class="o">);</span>
    <span class="n">notificationManager</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="n">getNotify</span><span class="o">(),</span> <span class="n">notificationBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>

<span class="o">}</span>
</code></pre>
</div>

<p>ููุงูุน ูุณุช ฺฉู ูุง ููโุฎูุงูู ูพุงู ุฏุฑุงูุช ุฑู ุจุตูุฑุช ูุงุชูฺฉุดู ุฏุฑุงูุช ฺฉูู. ุจูฺฉู ูุฎูุงู ูุซูุง ุงุทูุงุนุงุช ุฏุฑุงูุช ุฑู ุฏุฑ ุฏุชุงุจุณ ุฐุฎุฑู ฺฉููุ ุง ูุฎูุงูู ฺุฒ ุฑู ุจู ฺฉุงุฑุจุฑ ูุดูู ุจุฏู. ูู ุฏุฑ ุงู ููููู ูุฎูุงุณุชู ฺฉู ุจู ฺฉุงุฑุจุฑ ู ุฏุงููฺฏ ูุดูู ุจุฏู.
ูู ููุฏุงุฑ <strong>type</strong> ูพุงู ุฑู ุจุฑุงุจุฑ <code class="highlighter-rouge">dialog_message</code> ฺฏุฐุงุดุชู. ฺฉู ุจุนุฏุด ุชุงุจุน <code class="highlighter-rouge">broadcastTheMessage</code> ูุฑุงุฎูู ูุดูุ ู ุงู ุชุงุจุน ุฏุชุง ุฏุฑุงูุช ุฑู ุฏุฑ ุฏุงุฎู ุงูพูฺฉุดู <strong>BroadCast</strong> ูฺฉูู.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">broadcastTheMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">){</span>
    <span class="n">Intent</span> <span class="n">notification</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">FCM_ACTION_NEW_NOTIFICATION</span><span class="o">);</span>
    <span class="n">notification</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="n">title</span><span class="o">);</span>
    <span class="n">notification</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
    <span class="n">LocalBroadcastManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">sendBroadcast</span><span class="o">(</span><span class="n">notification</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<p>ุฎูุจ ููุชุดู ุชุธูุงุช ูุฑุจูุท ุจู ุงููุฌุง ฺฉู ูุฑุงุฑู ุฏุงููฺฏ ุฑู ูุดูู ุจุฏู ูู ุงูุฌุงู ุจุฏู. ูพุณ ุฏุฑ MainActivity ุงูู ูุงู ู <code class="highlighter-rouge">BroadcastReceiver</code> ุงุฌุงุฏ ูฺฉูู ู ุจูุด ูฺฏู ูุฑูููุน ูพุงู ุฏุฑุงูุช ฺฉุฑุฏ ฺฉู ฺฉูุฏ <strong>FCM_ACTION_NEW_NOTIFICATION</strong> ุฑู ุฏุงุดุชุ ูุชุฏ ููุฑุฏ ูุธุฑ ูู ุฑู ุตุฏุง ฺฉู.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="n">BroadcastReceiver</span> <span class="n">mRegistrationBroadcastReceiver</span><span class="o">;</span>

<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">mRegistrationBroadcastReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BroadcastReceiver</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">switch</span> <span class="o">(</span><span class="n">intent</span><span class="o">.</span><span class="na">getAction</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">case</span> <span class="nl">FCM_ACTION_NEW_NOTIFICATION:</span>
                    <span class="n">showDialog</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span> <span class="c1">//Call the method that shows AlertDialog</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>
</code></pre>
</div>

<p>ู ุจุนุฏุด ูู ุฏุฑ ูุชุฏ <code class="highlighter-rouge">onResume</code> ูุงุฒูู ฺฉู ุจฺฏู ุงู ุงฺฉุชูุช ุฑู ุจุฑุง ูพุงู ุจุฑูุฏฺฉุณุช ุดุฏู ุง ฺฉู ฺฉูุฏุด <strong>FCM_ACTION_NEW_NOTIFICATION</strong> ูุณุชุ ุฑุฌุณุชุฑ ฺฉู.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
    <span class="n">LocalBroadcastManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">registerReceiver</span><span class="o">(</span><span class="n">mRegistrationBroadcastReceiver</span><span class="o">,</span> <span class="k">new</span> <span class="n">IntentFilter</span><span class="o">(</span><span class="n">FCM_ACTION_NEW_NOTIFICATION</span><span class="o">));</span>
<span class="o">}</span>
</code></pre>
</div>

<p><strong>ูฺฉุชู:</strong> ุชูุฌู ฺฉูุฏ ฺฉู ุฑุฌุณุชุฑ ฺฉุฑุฏู ุจุฑุง ฺฉ ุจุฑุงุฏฺฉุณุช ุญุชูุง ุจุงุฏ ุจุนุฏ ุงุฒ ุณุงุฎุชู BroadcastReceiver ุจุงุดู.</p>

<p>ููู ฺ ุขูุงุฏุณุช. ุงฺฏู ูพุงู ูุนููู ุงุฑุณุงู ฺฉูู ุง ุจุตูุฑุช ุฏุชุง ุจูุฑุ ุจู ุฑุงุญุช ูุงุชูฺฉุดู ุฑู ูุดูู ูุฏู.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-9.png" alt="Firebase Notification" /></p>

<p>ู ุงฺฏุฑ ูู ููุน ูพุงู data ุจุตูุฑุช dialog ุจุงุดูุ ุจุฑุงุฏฺฉุณุช ุจู ุฑุงุญุช ุฏุฑุงูุช ุดุฏู ู ุฏุงููฺฏ ูุดูู ุฏุงุฏู ูุดู.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-11.jpg" alt="Firebase Notification" /></p>

<h3 id="send-and-receive-notification">ุงุฑุณุงู ู ุฏุฑุงูุช ูุงุชูฺฉุดู ุจุฑุง ฺฏุฑูู ุงุฒ ฺฉุงุฑุจุฑุงู</h3>

<p>ุฎุจ ุชุง ุงูุงู ุงุฏ ฺฏุฑูุชู ฺฉู ุจุฑุง ฺฉุงุฑุจุฑุงู ุงูพูฺฉุดูููู ูุงุชูฺฉุดู ุจูุฑุณุชู. ุงูุง ููุงูุน ูพุด ูุงุฏ ฺฉู ููุฎูุงู ุจุฑุง ููู ฺฉุงุฑุจุฑูุง ูพุงู ุงุฑุณุงู ฺฉููุ ุจูฺฉู ูุฎูุงู ููุท ฺฏุฑูู ุงุฒ ุงูููุง ูพุงู ูุงุฑู ุฏุฑุงูุช ฺฉููุฏ. ุงูุง ฺุทูุฑุ</p>

<p>ูุง ุจู ุฏู ุตูุฑุช ูโุชููู ูพุงู ุงุฑุณุงู ฺฉูู:</p>

<ol>
  <li>
    <p>ุงุฑุณุงู ูพุงู ุจุฑ ุงุณุงุณ ุชูฺฉู ฺฉุงุฑุจุฑ (ุจุตูุฑุช ูุฑุฏ ุง ฺฏุฑูู)</p>
  </li>
  <li>
    <p>ุงุฑุณุงู ูพุงู ุจุฑ ุงุณุงุณ Topic</p>
  </li>
</ol>

<p>ุชุง ูุจู ุงุฒ ุงู ูุง ุจุฑ ุงุณุงุณ ุชูฺฉู ุจู ฺฉุงุฑุจุฑ ูพุงู ูโูุฑุณุชุงุฏู. ุจูุชุฑู ู ูฺฏุงู ุจู ุณุงุฎุชุงุฑ ุฑฺฉูุฆุณุช ฺฉู ุจุฑุง FCM ุงุฑุณุงู ูฺฉูู ุจูุฏุงุฒู:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
   <span class="na">notification</span><span class="p">:</span> <span class="p">{</span>
       <span class="s2">"title"</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
       <span class="s2">"body"</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">message</span>
   <span class="p">},</span>
   <span class="na">to</span> <span class="p">:</span> <span class="nx">USER_KEY</span><span class="p">,</span>
   <span class="c1">// to : TOPIC_GLOBAL,</span>
   <span class="c1">// to : TOPIC_VIP_USER,</span>
   <span class="c1">// condition : "'onscreen' in topics &amp;&amp; 'vip_user' in topics",</span>
<span class="p">};</span>
</code></pre>
</div>

<p>ูุง ุฏุฑ <strong>payload</strong> (ุฏุฑูุงูุน ุฏุฑุฎูุงุณุช ฺฉู ุจู ุณูุช FCM ุงุฑุณุงู ูุดู)ุ ุฏู ุจุฎุด ุงุตู ุฏุงุฑูุ ุงูู <code class="highlighter-rouge">notification</code> ุง <code class="highlighter-rouge">data</code> ฺฉู ุญุงูู ูพุงู ูุง ุจู ฺฉุงุฑุจุฑ ูุณุชูุฏ ู <code class="highlighter-rouge">to</code> ุง <code class="highlighter-rouge">condition</code> ฺฉู ููุตุฏ ู ุฏุฑุงูุช ฺฉููุฏู ูพุงู ุฑู ูุดุฎุต ูฺฉูู. ุงูุง ูุฑฺฉุฏูู ฺฺฉุงุฑ ูโฺฉููุฏ:</p>

<ul>
  <li>
    <p>ููุตุฏ ูุดุฎุต <strong>to</strong></p>

    <p>ูุง ุจุง ุฏููุณุชู ุชูฺฉู ฺฉุงุฑุจุฑ ูโุชููู ูพุงู ุฑู ุจู ู ฺฉุงุฑุจุฑ ุฎุงุต ุง ูุฌููุนู ุง ุงุฒ ฺฉุงุฑุจุฑูุง ุงุฑุณุงู ฺฉูู. ุจุฑุง ูุซุงู:</p>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">to</span><span class="err">:</span> <span class="s2">"XXXXX:YYYYYYYUUUUUIIIIOOOOOO"</span><span class="p">,</span>
<span class="c1">//or</span>
<span class="nx">to</span><span class="err">:</span> <span class="p">[</span><span class="s2">"XXXXX:YYYYYYYUUUUUIIIIAAAAA"</span><span class="p">,</span> <span class="s2">"XXXXX:YYYYYYYUUUUUIIIIBBBBB"</span><span class="p">,</span> <span class="s2">"XXXXX:YYYYYYYUUUUUIIIICCCCC"</span><span class="p">]</span>
</code></pre>
</div>

<p>ุณุฑูุณ FCM ุจู ูุง ุงุฌุงุฒู ูโุฏู ฺฉู ฺฉุงุฑุจุฑูุงููู ุฑู ุฏุฑ <code class="highlighter-rouge">Topic</code> ุง ููุถูุน (ู ููุถูุนโูุง) ุฎุงุต ุนุถู ฺฉูู. ู ุจุฏู ุชุฑุชุจ ูพุงู ููุท ุจุฑุง ฺฉุงุฑุจุฑุงู ฺฉู ุฏุฑ ููุงู ููุถูุน ุนุถู ูุณุชูุฏ ุงุฑุณุงู ุจุดู. ุจู ุงู ููุธูุฑ ููุตุฏ ุฏุฑุงูุช ุฑู ุจุง ฺฉูุฏูุงฺู <strong>topics</strong> ู ูุงู ุชุงูพฺฉ ูโููุณู. ุจุฑุง ูุซุงู ุฏุฑ ุฒุฑุ ููุตุฏู ูพุงู ุจุฑุง ฺฉุงุฑุจุฑุงู ฺฉู ุนุถู ููุถูุน <code class="highlighter-rouge">vip_user</code> ูุณุชูุฏ ุชุนุฑู ุดุฏู:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">to</span><span class="err">:</span> <span class="s2">"/topics/vip_user"</span>
</code></pre>
</div>

<ul>
  <li>
    <p>ููุตุฏ ุดุฑุท <strong>condition</strong></p>

    <p>ููุตุฏ ุดุฑุท ุง conditional ุจู ูุง ุงู ุงูฺฉุงู ุฑู ูุฏู ฺฉู ูพุงู ุฑู ุจู ฺฉุงุฑุจุฑุงู ุจุฑ ุงุณุงุณ ุดุฑุท ุนุถูุช ุงูููุง ุฏุฑ ุชุงูพฺฉโูุง ุฎุงุต ุจุตูุฑุช AND ู OR ุงุฑุณุงู ฺฉูู. ุจุฑุง ูุซุงู ุฏุฑ ุฒุฑ ูพุงู ุจุฑุง ฺฉุงุฑุจุฑุงู ฺฉู ุนุถู VIP ุจูุฏู ู ููฺูู ุฎุงูู ูุณุชูุฏ ุงุฑุณุงู ูุดู:</p>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">condition</span> <span class="err">:</span> <span class="s2">"'gender_female' in topics &amp;&amp; 'vip_user' in topics"</span>
</code></pre>
</div>

<h3 id="user-topics">ุงุฑุณุงู ู ุฏุฑุงูุช ูุงุชูฺฉุดู ุจุฑ ุงุณุงุณ Topic ุง ููุถูุน ุฎุงุต</h3>

<p>ุฏุฑ ุงู ูพุฑูฺู ุง ฺฉู ุจุฑุง ููููู ุณุงุฎุชูุ ุฎูุงุณุชู ูพุงู ุจุฑุง ฺฉุงุฑุจุฑุงู ฺฉู ุฏุฑุญุงู ุญุงุถุฑ ุตูุญู ุงูพูฺฉุดูุดูู ุจุงุฒ ุจูุฏู ู ุงุฒ ููุน VIP ุจูุฏู ุงุฑุณุงู ฺฉูู. ูพุณ ุงูู ุงุฒ ููู ูููุน ฺฉู ุงูพูฺฉุดู ูุงูฺ ุดุฏ ุฏุฑ ูุชุฏ <code class="highlighter-rouge">onResume</code> ุงูููุงุฑู ุฏุฑ ุชุงูพฺฉ <code class="highlighter-rouge">onscreen</code> ุนุถู ฺฉุฑุฏู:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
   <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
   <span class="n">FirebaseMessaging</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">subscribeToTopic</span><span class="o">(</span><span class="s">"onscreen"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<p>ู ููุช ูู ูุฑู ุฑู <code class="highlighter-rouge">onPause</code> ุนุถูุชุด ุฑู ุงุฒ ุงูู ุชุงูพฺฉ ูุบู ูฺฉูู:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
   <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
   <span class="n">FirebaseMessaging</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">unsubscribeFromTopic</span><span class="o">(</span><span class="s">"onscreen"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<p>ู ุญุงูุง ุจุฑุง ุนุถูุช ุฏุฑ ุญุงูุช VIP ู FloatActionButton ุณุงุฎุชู ฺฉู ููุช ฺฉุงุฑุจุฑ ุฑูุด ฺฉูฺฉ ูฺฉูู ุงูู ุฑู ุนุถู VIP ฺฉุฑุฏู ุง ุนุถูุชุด ุฑู ูุบู ูฺฉูู.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">setUserVIP</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">isVIP</span><span class="o">,</span> <span class="n">View</span> <span class="n">view</span><span class="o">){</span>
    <span class="n">getSharedPreferences</span><span class="o">(</span><span class="n">FCM</span><span class="o">,</span> <span class="mi">0</span><span class="o">).</span><span class="na">edit</span><span class="o">().</span><span class="na">putBoolean</span><span class="o">(</span><span class="n">VIP_USER</span><span class="o">,</span> <span class="n">isVIP</span><span class="o">).</span><span class="na">apply</span><span class="o">();</span>
    <span class="n">VIPUser</span><span class="o">.</span><span class="na">setImageResource</span><span class="o">(</span> <span class="n">isVIP</span> <span class="o">?</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">special</span> <span class="o">:</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">not_special</span> <span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">isVIP</span><span class="o">){</span>
        <span class="n">Snackbar</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="s">"You are a VIP user."</span><span class="o">,</span> <span class="n">Snackbar</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
        <span class="n">FirebaseMessaging</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">subscribeToTopic</span><span class="o">(</span><span class="s">"vip_user"</span><span class="o">);</span>
    <span class="o">}</span><span class="k">else</span><span class="o">{</span>
        <span class="n">Snackbar</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="s">"You are a regular user"</span><span class="o">,</span> <span class="n">Snackbar</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
        <span class="n">FirebaseMessaging</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">unsubscribeFromTopic</span><span class="o">(</span><span class="s">"vip_user"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>ุฎุจุ ูููโฺ ุขูุงุฏุณุชุ ู ููุท ฺฉุงูู ุงุฒ Postman ู ุฑฺฉุฆูุณุช ุฑู  <code class="highlighter-rouge">/send/data-notification/VIP</code> ุจูุฑุณุชูุ ู ูุชุฌู ุงูฺฉู:</p>

<p><img src="/assets/img/post/2017-10-24/fcm-10.png" alt="Firebase Notification" /></p>

<h3 id="send-message-to-all">ุงุฑุณุงู ูพุงู ุจุฑุง ููู ฺฉุงุฑุจุฑุงู</h3>

<p>ุญุงูุง ุงฺฏู ุจุฎูุงู ูพุงู ุจุฑุง ููู ฺฉุงุฑุจุฑุง ุงุฑุณุงู ุจุดู ฺุ ุขุง ุจุงุฏ ุชูฺฉู ููู ฺฉุงุจุฑุงุฑู ูุณุช ฺฉูู ู ุจูุฑุณุชูุ ููุ ูุงุฒ ุจู ุงูฺฉุงุฑ ูุณุช! ููุท ฺฉุงูู ูููู ุงูู ฺฉู ุงูพูฺฉุดู ฺฉุงุฑุจุฑ ุฑู ุนุถู ุชุงูพฺฉ <code class="highlighter-rouge">global</code> ฺฉูุฏ ู ุจุฏู ุตูุฑุช ููู ฺฉุงุฑุจุฑุงูุชูู ุนุถู ุงู ุชุงูพฺฉ ูุดู.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>

    <span class="n">FirebaseMessaging</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">subscribeToTopic</span><span class="o">(</span><span class="s">"global"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<p>ูุจุนุฏุ ูุฑูููุน ุฎูุงุณุชุฏ ูพุงู ุจุฑุง ููู ฺฉุงุฑุจุฑุงู ุงุฑุณุงู ุจุดูุ ููุท ฺฉุงูู ุณูุช ุณุฑูุฑ ุชุงูพฺฉู ููุตุฏ ุฑู ุฑู <code class="highlighter-rouge">global</code> ุณุช ฺฉูุฏ:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">to</span><span class="err">:</span> <span class="s2">"/topics/global"</span>
</code></pre>
</div>

<h3 id="other-settings">ุฏฺฏุฑ ุชูุธูุงุช ุงุฑุณุงู ูพุงู</h3>

<p><b id="other-settings-priority">ุงูููุช Priority:</b> ุดูุง ูุชููุฏ ุจุฑุง ูพุงู ฺฉู ุงุฑุณุงู ูโฺฉูุฏ ุงูููุช ฺฏุฐุงุฑ ฺฉูุฏ. ูุง ุจู ุงุฒุง ูุฑ ูพุงู ุฏู ุงูููุช  <code class="highlighter-rouge">normal</code>ย ู <code class="highlighter-rouge">high</code> ุฏุงุฑู.</p>

<ul>
  <li>
    <p>high: ุงู ุงูููุช ุจุฑุง ููุงูุนโุณุช ฺฉู ูุฎูุงู ูพุงู ุฏุฑ ุณุฑุนุชุฑู ุฒูุงู ููฺฉู ุจู ุฏุณุช ฺฉุงุฑุจุฑ ุจุฑุณูุโู ุงฺฏุฑ ุงูููุช ููู ุจุงุดูุ ุญุช ูููุน ฺฉู ฺฏูุด ูุงฺฉ ุจูุฏู ู ุงูุชุฑูุชุด ุจุฑุง ุตุฑููโุฌู ุจุฑู ูุทุน ุจุงุดูุ ุงูุชุฑูุช ุฑู ูุตู ูฺฉููุ ูพุงู ุฑู ุฏุฑุงูุช ูฺฉูู ู ุจู ฺฉุงุฑุจุฑ ูุดูู ูุฏู. ุงู ุญุงูุช ุจุฑุง ุงูพโูุง ฺฉู ูพุงูโุฑุณุงู ูุณุชูุฏ ุง ุจุงุฏ ูพุงู ูููู ูุญุธู ุจู ุฏุณุช ฺฉุงุฑุจุฑ ุจุฑุณูุ ุจุดุชุฑ ุงุณุชูุงุฏู ูุดู. ุฏุฑ ุญุงูุช ูพุดูุฑุถ ุจุฑุง ูพุงูโูุง notification ุงูููุช ุฑู high ูุฑุงุฑ ุฏุงุฑู.</p>
  </li>
  <li>
    <p>normal: ุงู ุงูููุช ุจุฑุง ููุงูุนโุณุช ฺฉู ุฒูุงู ุฑุณุฏู ูพุงู ุงููุช ูุฏุงุฑูุโู ุจู ูุญุถ ุงูฺฉู ฺฉุงุฑุจุฑ ฺฏูุดุดู ุงุฒ ูุงฺฉ ุฏุฑ ุจุงุฑู ู ุงูุชุฑูุชุด ูุตู ุจุดู ูพุงู ุฑู ุจูุด ูุดูู ูุฏู. ุฏุฑุญุงูุช ูพุดูุฑุถ ุจุฑุง ูพุงูโูุง data ุงูููุช ุฑู normal ูุฑุงุฑ ุฏุงุฑู.</p>

    <p>ุงูุจุชู ุดูุงโ ูโุชููุฏ ุฎูุฏุชูู ุจุตูุฑุช ุฏุณุช ูู ุงูููุช ุฑู ุจุฑุง ุงูู ูพุงู ูุดุฎุต ฺฉูุฏ.</p>

    <p>ุจุฑุง ุงู ููุธูุฑ ุฏุฑ ุณุฑูุณ Node.js ู ุฏุฑ ุจุฎุด optionsุ ุขุชู ูุฑุจูุท ุจู priority ุฑู ุงุถุงูู ูโฺฉูู.</p>
  </li>
</ul>

<p><b id="other-settings-time-to-alive">ุฒูุงู ุงุนุชุจุงุฑ ูพุงู timeToLive:</b> ููฺฉู ุงุณุช ุดูุง ุจุฎูุงุฏ ุจุฑุง ูพุงู ุฎูุฏุชูู ุงุนุชุจุงุฑ ุฒูุงู ุงุนูุงู ฺฉูุฏุ ู ุงฺฏู ูพุงู ุชุง ููุงู ูููุน ุฑุณุฏ ุฏุณุช ฺฉุงุฑุจุฑ ฺฉู ูฺุ ุงฺฏู ูุฑุณุฏ ุฏฺฏู ุจู ุฏุฑุฏ ููุฎูุฑู ูุฑุณูู ุจูุด. ุจุตูุฑุช ูพุดูุฑุถ ุงู ููุฏุงุฑ ุฑู ฐ ูุฑุงุฑ ุฏุงุฑู. ุณุฑูุณ FCM ุชูุงู ุชูุงุดุดู ูฺฉูู ุชุง ูพุงูุชูู ุญุชูุง ุจู ฺฉุงุฑุจุฑ ุจุฑุณู ูู ุฎุจ ุงุนุชูุงุฏ ุฏุงุฑู โNow or Neverโุ ุนู ูพุงูุชูู ุง ููู ุงูุงู ุจู ุฏุณุช ฺฉุงุฑุจุฑ ูุฑุณู ุง ุงุตู ููุฑุณู! ๐
ุจุฑุง ุงู ููุฑุฏ ุฏุฑ ุณุฑูุณ Node.js ู ุฏุฑ ุจุฎุด optionsุ ุขุชู ูุฑุจูุท ุจู timeToLive ุฑู ุงุถุงูู ูโฺฉูู.</p>

<p><b id="other-settings-collapse-key">ฺฉูุฏ ุฌุงฺฏุฒู ูพุงู collapse_key:</b> ุงูุจุชู ูุนู ุชุญุช ุงููุถู ุงู ุนุจุงุฑุช ูุดู (ฺฉูุฏ ุงุถูุญูุงู ๐๐คฃ). ูุฑุถ ฺฉูุฏ ุงูููุช ูพุงู ุฏุฑุญุงูุช normal ูุฑุงุฑ ุฏุงุฑู. ู ูพุงู ุจุฑุง ฺฉุงุฑุจุฑ ฺฉู ููุฑุณุชู ฺฉู ูุซูุง ูฺฏู ููุงู ุฌูุณ ฒตูช ุชุฎูู ุฏุงุฑู ุงฺฏู ููู ุงูุงู ุจุฎุฑ. ุจุนุฏ ููโุณุงุนุช ุชุตูู ฺฏุฑูุชู ฺฉู ุฏุฑุตุฏ ุฑู ฺฉุงูุด ุจุฏู ุจู ฑฐูช. ุงูููุง ฺฉู ูููุฒ ูพุงู ุฑู ูุฏุฏู ูุงุฒู ูุจุงุดู ูพุงู ูุจูู ุจุจูู ฺฉู ฺฏุฌ ุจุดูุ ููู ฑฐูช ุฑู ุจุจูู ฺฉุงูู. ุจุฑุง ุงูฺฉุงุฑ ุงุฒ <code class="highlighter-rouge">collapse_key</code> ุงุณุชูุงุฏู ูโฺฉูู.</p>

<p>ููฺฏุงู ฺฉู ุงูพูฺฉุดู ุฏุฑ ุญุงูุช Lock ูุฑุงุฑ ุฏุงุฑูุ ูพุงู ุฑู ุจู ฺฉุงุฑุจุฑ ูุดูู ููุฏู ุชุง  ูููุน ฺฉู ฺฉุงุฑุจุฑ ฺฏูุดุดู unlock ฺฉููุ ุงฺฏุฑ ูพุงู ุฌุฏุฏ ุจุง ูููู ฺฉูุฏ ุฏุฑุงูุช ฺฉุฑุฏุโ ูพุงู ูุจู ุฑู discard ฺฉุฑุฏู ู ุจุฌุงุด ุงู ูพุงู ุฌุฏุฏ ุฑู ูฺฏู ูโุฏุงุฑู ุชุง ูุดูู ุจุฏู.
ุจุฑุง ุงู ููุฑุฏ ุฏุฑ ุณุฑูุณ Node.js ู ุฏุฑ ุจุฎุด optionsุ ุขุชู ูุฑุจูุท ุจู collapse_key ุฑู ุงุถุงูู ูโฺฉูู.
ูพุณ ุฏุฑููุงุช ููุงุฏุฑ ุขูพุดู ูุดู:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">method</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
  <span class="na">uri</span><span class="p">:</span> <span class="s1">'https://fcm.googleapis.com/fcm/send'</span><span class="p">,</span>
  <span class="na">body</span><span class="p">:</span> <span class="nx">payload</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">'Content-Type'</span><span class="p">:</span> <span class="s1">'application/json'</span><span class="p">,</span>
      <span class="s1">'Authorization'</span><span class="p">:</span> <span class="nx">API_KEY</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">json</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">priority</span><span class="p">:</span> <span class="s2">"high"</span><span class="p">,</span> <span class="c1">// or set it on -normal- priority</span>
  <span class="na">timeToLive</span><span class="p">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="c1">// this message has 24hours to be expired</span>
  <span class="na">collapseKey</span><span class="p">:</span> <span class="s2">"discount"</span><span class="p">,</span> <span class="c1">//or what ever you want</span>
<span class="p">};</span>
</code></pre>
</div>

<h2 id="conclusion">ูุชุฌู ฺฏุฑ</h2>

<p>ูฺฉุฑ ููฺฉูู ุฏฺฏู ููุฑุฏ ุจุฑุง ฺฏูุชู ูููุฏู ุจุงุดู. ุณุน ฺฉุฑุฏู ุชูุงู ฺุฒูุง ฺฉู ูุงุฒูู ุฑู ุฐฺฉุฑ ฺฉุฑุฏู ุจุงุดู. ููุท ููููู ุงุฑุณุงู ูพุงู ูุงุชูฺฉุดู ุงุฒ ุฏุงุฎู ุฎูุฏ ฺฉูุณูู ูุงุฑุจุณ ฺฉู ุงูู ุจูููู ุจุนุฏ ุงุฒ ูุณูุช Analytics ุจูุด ูโูพุฑุฏุงุฒูุ ฺูู ุจุฎุดโูุง ุงุฒ ุณุฑูุณ Analytics ุฏุฑ ุงูู ุฏุฎู ูุณุชูุฏ.</p>

<p>ุงูุฏูุงุฑู ุจู ุฑุงุญุช ุจุชููุฏ ุงุฒ ุงู ุณุฑูุณ ุงุณุชูุงุฏู ฺฉูุฏ. ุงฺฏู ุณูุงู ุง ูุดฺฉู ุจูุฏ ูโุชููุฏ ุงุฒ ุทุฑู <a href="https://twitter.com/sadra_amlashi">ุชูุชุฑ</a> ุง <a href="https://t.me/amlashi">ุชูฺฏุฑุงู</a> ูพุงู ุจุฏุฏ ุชุง ุจุงูู ุฏุฑ ุงุฑุชุจุงุท ุจุงุดู. ๐</p>

<p>ุฏุฑุตูุฑุช ฺฉู ุจู ููุงุฑุฏ ุฌุฏุฏ ุจุฑุฎูุฑุฏูุ ุงู ูพุณุช ุฑู ุจูโุฑูุฒุฑุณุงู ุฎูุงูู ฺฉุฑุฏ.</p>

        </div>


        <div class="post-routes-list">
            
            <a class="category-link" href="/category/ูุงุฑุจุณ">ูุงุฑุจุณ</a>
            
            <a class="category-link" href="/category/ุขููุฒุด">ุขููุฒุด</a>
            
            
            <a class="tag-link" href="/tag/google">Google</a>
            
            <a class="tag-link" href="/tag/firebase">Firebase</a>
            
            <a class="tag-link" href="/tag/android">Android</a>
            
        </div>


        <div class="Prev-next-post-container">
            
            <a class="previous-btn" href="/2017/set-fire-into-the-problems-with-firebase">ููุดุชู ูุจู: ุจุง Firebase ูุดฺฉูุงุชุชุงู ุฑุง ุจู ุขุชุด ุจฺฉุดุฏ! โ</a>
            
            
            <a class="next-btn" href="/2017/js-promise">โ ููุดุชู ุจุนุฏ: Promise ุชุงุจุญุงู ูฺููุช ุงููุฏุฑ ุขุณูู ูุจูุฏู</a>
            
        </div>


    </div>

</div>

<a id="back-to-top" class="back-to-top" role="button" title="Click to return on the top page" data-toggle="tooltip" data-placement="left" onclick="topFunction()">
    <img src="/assets/img/base/arrow-up.png" class="arrow-up"/>
</a>


        <!-- Footer -->
<footer class="footer-wrapper">

    <div class="delimiter">
        <a href="/" class="footer-logo">
            <img src="isapanah.com/assets/img/base/favicon.png" class="logo-wrapper">
        </a>
    </div>

    <p class="footer-copyright">
        2008 - 2017<br>
        ูุทุงูุจ ุชุญุช ูุณุงูุณ <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/" rel="license" target="_blank">ฺฉุฑุชู ฺฉุงููุฒ</a> ููุชุดุฑ ูโุดููุฏ.

    </p>

    <div class="footer-social-links">
        <a href="https://twitter.com/sadra-amlashi" title="Twitter" target="_blank"><i class="fa fa-twitter"></i></a>
        <a href="https://github.com/sadra" title="Github" target="_blank"><i class="fa fa-github"></i></a>
        <a href="https://medium.com/sadra" title="Medium" target="_blank"><i class="fa fa-medium"></i></a>
        <a href="https://www.linkedin.com/in/amlashisadra/" title="Linkedin" target="_blank"><i class="fa fa-linkedin"></i></a>
        <a href="https://facebook.com/sadra.am123" title="Facebook" target="_blank"><i class="fa fa-facebook"></i></a>
    </div>


 </footer>
<!-- /Footer -->

        
    </body>
</html>
