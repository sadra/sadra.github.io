<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" dir="rtl" lang="fa-IR">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" dir="rtl" lang="fa-IR">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html dir="rtl" lang="fa-IR">
<!--<![endif]-->
    <head>
        <meta charset="utf-8"/>
<meta content="IE-edge,chrome=1" http-equiv="X-UA-Compatable"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="keywords" content="Google,Firebase,Android, فایربیس,آموزش"/>
<meta name="author" content="Sadra Isapanah Amlashi | صدرا عیسی پناه املشی"/>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script>
    (function(b,l,e,g,h,f){1!==parseInt(e.msDoNotTrack||b.doNotTrack||e.doNotTrack,10)&&b.addEventListener("load",function(){var r=(new Date).getTime();b.galite=b.galite||{};var m=new XMLHttpRequest,n="https://www.google-analytics.com/collect?cid="+(l.uid=l.uid||Math.random()+"."+Math.random())+"&v=1&tid="+galite.UA+"&dl="+f(h.location.href)+"&ul=en-us&de=UTF-8",a=function(b){var d="",c;for(c in b){if(void 0===b[c])return!1;d+=f(b[c])}return d},p={dt:[h.title],sd:[g.colorDepth,"-bit"],sr:[g.availHeight,
        "x",g.availWidth],vp:[innerWidth,"x",innerHeight],dr:[h.referrer]},k;for(k in p){var q=k+"="+a(p[k]);q&&(n+="&"+q)}a=function(b,d){var c="",a;for(a in d)c+="&"+a+"="+f(d[a]);return function(){var a=n+c+(galite.anonymizeIp?"&aip=1":"")+"&t="+f(b)+"&z="+(new Date).getTime();if(e.sendBeacon)e.sendBeacon(a);else try{m.open("GET",a,!1),m.send()}catch(t){(new Image).src=a}}};setTimeout(a("pageview",null),100);b.addEventListener("unload",a("timing",{utc:"JS Dependencies",utv:"unload",utt:(new Date).getTime()-
    r}))})})(window,localStorage,navigator,screen,document,encodeURIComponent);

    var galite = galite || {};
    galite.UA = 'UA-107934487-1'; // Insert your tracking code here
</script>

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@sadra_amlashi" />
<meta name="twitter:creator" content="@sadra_amlashi" />

<meta property="og:type" content="website" />
<meta property="og:locale" content="fa_IR" />
<meta property="og:url" content="isapanah.com/2017/how-to-fcm-android" />


<meta name="description" content="سلام! من صدرا عیسی پناه املشی هستم. توسعه دهنده اپلیکیشن iOS و Android.
"/>
<meta property="og:description" content="سلام! من صدرا عیسی پناه املشی هستم. توسعه دهنده اپلیکیشن iOS و Android.
"/>
<meta name="twitter:description" content="سلام! من صدرا عیسی پناه املشی هستم. توسعه دهنده اپلیکیشن iOS و Android.
"/>




<title>فایربیس ۱: سرویس Firebase Cloud Messaging | صدرا املشی</title>
<meta property="twitter:title" content="فایربیس ۱: سرویس Firebase Cloud Messaging | صدرا املشی"/>
<meta property="og:site_name" content="فایربیس ۱: سرویس Firebase Cloud Messaging | صدرا املشی"/>
<meta property="og:title" content="فایربیس ۱: سرویس Firebase Cloud Messaging | صدرا املشی"/>



<meta property="twitter:image" content="isapanah.com/assets/img/post/2017-10-24/fcm-cover.png" />
<meta property="og:image" content="isapanah.com/assets/img/post/2017-10-24/fcm-cover.png" />


<link rel="alternate" type="application/rss+xml" title="کیبرد آزاد » Feed" href="/site-map.xml"/>
<link rel="alternative" href="/site-map.xml" title="وبلاگ صدرا املشی" type="application/atom+xml"/>
<link rel="short icon" type="image/x-icon" href="isapanah.com/assets/img/base/favicon.png"/>
<link rel="stylesheet" type="text/css" href="isapanah.com/assets/css/styles.css"/>
    </head>

    <body dir="rtl" lang="Farsi" >
        <!-- Header -->
<header class="header-rtl">
    <nav class="nav-wrap">
        <a href="/" class="nav-logo">وبلاگ صدرا املشی</a>
        <ul class="navigation">

            <li><a href="/">یادداشت‌ها</a></li>
            <li><a href="/list/items">موضوعات</a></li>
            <li><a href="/about">درباره</a></li>
            <li><a href="http://cv.isapanah.com/">رزومه</a></li>
            <li><a href="https://sadra.github.io/english">English</a></li>

        </ul>
    </nav>
</header>
<!-- /Header -->

        <script>

    window.onscroll = function() {scrollFunction()};

    function scrollFunction() {
        document.getElementById("back-to-top").style.display = (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) ? "block" : "none";
    }

    function topFunction() {
        document.body.scrollTop = 0; // For Safari
        document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    }

</script>


<div class="content">

    <div class="blog-post-container">

        <div class="post-title-container">
            <h1 class="post-title">فایربیس ۱: سرویس Firebase Cloud Messaging</h1>
        </div>

        <div class="post_created">

            <div class="author_avatar">
                <img src="/assets/img/base/avatar.jpg" alt="صدرا املشی" id="avatar-img" />
            </div>

            <div class="post_info">
                <p> <a href="/about">صدرا املشی</a> </p>
                <small>توسعه دهنده</small><br/>
                <small>سه‌شنبه 02 آبان 1396</small>
            </div>

        </div>

        
        <div class="post-cover">
            <img src="isapanah.com/assets/img/post/2017-10-24/fcm-cover.png" alt="فایربیس ۱: سرویس Firebase Cloud Messaging">
        </div>
        

        <div class="post-content">
            <p>بنا بر قولی که در <a href="http://isapanah.com/2017/set-fire-into-the-problems-with-firebase">پست قبلی</a> داده بودم، میخوام در یک مجموعه نوشته درباره پیاده سازی و استفاده از سرویس‌های مختلف فایربیس (تا جایی که این امکان برای ما در ایران وجود داشته باشه) صحبت کنم. شما می‌تونید پست‌های این بلاگ را، در رابطه با سرویس‌های فایربیس، از این <a href="http://isapanah.com/tag/firebase">لینک موضوعی</a> مطالعه کنید.</p>

<p>ازونجایی که مطالب زیاد بود و همچنین دسته بندی‌ها تودرتو، در ادامه فهرستی از کل مطالب و تیترهای موجود در این پست رو لیست کردم. با کلیک روی هر تیتر به اون موضوع هدایت می‌شید.</p>

<h2 id="فهرست-مطالب">فهرست مطالب</h2>

<ul>
  <li><a href="#introduction">معرفی Firebase Cloud Messaging</a></li>
  <li><a href="#fcm-account">افتتاح حساب و ایجاد یک پروژه اندروید در فایربیس</a></li>
  <li><a href="#basic-app-settings-for-fcm">تنظیمات اولیه اپلیکیشن اندروید</a></li>
  <li><a href="#node-service">سرویس پوش‌ناتیفیکیشن با Node.js</a>
    <ul>
      <li><a href="#prepare-node-service">آماده‌سازی سرویس Node.js</a></li>
      <li><a href="#using-nodejs">استفاده از سرویس Node.js</a>
        <ul>
          <li><a href="#node-notification">Notification</a></li>
          <li><a href="#node-data">Data</a></li>
          <li><a href="#node-combined-message">Combined Message</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#prepare-app-for-fcm">آماده سازی اپلیکیشن برای دریافت ناتیفیکیشن</a></li>
  <li><a href="#receiving-notification">دریافت ناتیفیکیشن</a>
    <ul>
      <li><a href="#send-and-receive-notification">ارسال و دریافت ناتیفیکیشن برای گروهی از کاربران</a></li>
      <li><a href="#user-topics">ارسال و دریافت ناتیفیکیشن بر اساس Topic یا موضوعی خاص</a></li>
      <li><a href="#send-message-to-all">ارسال پیام برای همه‌ی کاربران</a></li>
      <li><a href="#other-settings">دیگر تنظیمات ارسال پیام</a>
        <ul>
          <li><a href="#other-settings-priority">اولویت Priority</a></li>
          <li><a href="#other-settings-time-to-alive">زمان اعتبار پیام timeToLive</a></li>
          <li><a href="#other-settings-collapse-key">کلید جایگزینی پیام collapse_key</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#conclusion">نتیجه‌گیری</a></li>
</ul>

<h2 id="introduction">معرفی Firebase Cloud Messaging</h2>

<p>فایربیس کلاد مسیجینگ یا به اختصار FCM یکی از سرویس‌های کاربردی فایربیس هست که به شما کمک میکنه تا بتونین پیام‌هاتون رو در کمترین زمان و بدون هیچ هزینه‌ای به دست کاربرتون در پلتفرم‌های مختلفی مثل Android, iOS, WebApplication, C++, Unituy برسونید.پیام شما می‌تونه به یک کاربر، یا گروهی از کاربران، یا بر اساس یه تاپیک و موضوع ارسال بشه.
ایجاد یک سرویس و ارسال پیام به کاربران شما خیلی ساده‌ست. اول از همه با اضافه کردن SDK فایبربیس به اپلیکیشنتون، کاربرانتون رو در شبکه کلاد فایبربیس رجیستر می‌کنید. و بعد در سمت سرورتون یکسری کد می‌نویسید، تا توسط اون بتونید پیام‌هاتون رو به کاربر یا گروهی از کاربران ارسال کنید.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-13.png" alt="Firebase Cloud Messaging Console" /></p>

<p>شما می‌تونید ده‌ها، هزاران، یا حتی میلیون‌ها پیام در روز بدون هزینه و با دقت ۹۵٪ در کمتر از ۲۵۰میلی‌ثانیه بدون توجه به پلتفرم کاربر به دستشون برسونید. به همین سادگی، به همین خوشمزگی.😍</p>

<h2 id="fcm-account">افتتاح حساب و ایجاد یک پروژه اندروید در فایربیس</h2>

<p>پس از ثبت‌نام و ورود به <a href="https://console.firebase.google.com/">کنسول فایربیس،</a> می‌بینید که یک پروژه آماده و البته دمو به اسم <strong><a href="https://console.firebase.google.com/project/fir-demo-project/overview">Firebase Demo Project</a></strong> وجود داره، این پروژه فقط درحالت View Only و تنها برای دیدن امکانات فایربیس ایجاد شده. برای ایجاد اولین پروژه فقط کافیه روی Add Project کلیک کنید.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-0.png" alt="Firebase Cloud Messaging Console" /></p>

<p>در پنجره باز شده اسمی برای پروژه (FirebaseApp) می‌نویسیم. بهتره Country/region روی همون UnitedStates باقی بمونه. توجه کنید که برای استفاده از Firebase محدودیت وجود داره و فقط می‌تونید ۳ پروژه ایجاد کنید! برای ساختن بیشتر از ۳ پروژه یا باید با یه حساب کاربری دیگه وارد بشید یا اینکه هزینه پرداخت کرده و ظرفیت کنسولتون رو افزایش بدید.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-1.png" alt="Firebase Cloud Messaging Console" /></p>

<p>پروژه اولیه ایجاد شده. حالا وقتی وارد پنل می‌شید ۳تا گزینه دارید، ما از بین گزینه‌های پایین، Android App رو انتخاب می‌کنیم.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-2.png" alt="Firebase Cloud Messaging Console" /></p>

<p>خب، در این مرحله باید مشخصات اپ رو ثبت کنیم. اول از همه <strong>Package Address</strong> اپ رو وارد می‌کنیم، و بعد در <strong>App nickname</strong> همونطور که از اسمش مشخصه یه اسم برای پروژمون می‌نویسیم. در بخش <strong>SHA-1</strong> میتونید امضای امنیتی اپتون رو وارد کنید، درصورتی که خواستید امنیت بیشتری لحاظ کنید که فقط روی همون پکیج با همون امضا کار کنه (ما که خالی میزاریم 😇). و بعدش هم که <strong>Register App</strong> رو می‌زنیم.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-3.png" alt="Firebase Cloud Messaging Console" /></p>

<p>خب پروژه ایجاد شده، فقط کافیه فایل <strong>google-service.json</strong> رو دانلود کنیم و سپس روی Continue کلیک کنیم.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-4.png" alt="fcm-4" /></p>

<p>حالا اون فایل JSON رو، مثل تصویر زیر، به پروژه اپلیکیشنمون (که امیدوارم از قبل درسته کرده بوده باشید) در مسیر <code class="highlighter-rouge">../Project/app</code> کپی می‌کنیم.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-5.png" alt="Firebase Cloud Messaging Console" /></p>

<p>خب پروژمون ایجاد شده و کار تمومه.با کلیک روی پروژه اپلیکیشن ایجاد شده در کنسول فایربیس، می‌تونیم وارد پنل بشیم و کارهای که لازمه داریم رو انجام بدیم.</p>

<h2 id="basic-app-settings-for-fcm">تنظیمات اولیه اپلیکیشن اندروید</h2>

<p>قبل شروع همه‌چیز این رو بگم با مراجعه به <a href="https://github.com/sadra/FirebaseApp">این ریپوی گیتهاب</a>، می‌تونید به نمونه اپلیکیشنی که برای همین منظور ایجاد کردم دسترسی داشته باشید.</p>

<p>اول از همه در فایل build.gradle مربوط به <strong>project</strong>، خطوط زیر رو اصلاح و اضافه میکنیم.</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="c1">// Project-level build.gradle (&lt;project&gt;/build.gradle):</span>
<span class="n">buildscript</span> <span class="o">{</span>
  <span class="n">dependencies</span> <span class="o">{</span>
    <span class="c1">// Add this line</span>
    <span class="n">classpath</span> <span class="s1">'com.google.gms:google-services:3.1.0'</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>و در فایل build.gradle مربوط به <strong>app.module</strong> خطوط زیر رو در انتهای محتویات قبلی اضافه می‌کنیم:</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="c1">// App-level build.gradle (&lt;project&gt;/&lt;app-module&gt;/build.gradle):</span>
<span class="o">...</span>
<span class="c1">// Add to the bottom of the file</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'com.google.gms.google-services'</span>
</code></pre>
</div>

<p>و همچنین لازمه که لایبرری های مربوط به فایربیس رو هم به <strong>dependencies</strong> اضافه کنیم.</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="c1">// Project-level build.gradle (&lt;project&gt;/build.gradle):</span>
<span class="n">dependencies</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="c1">// Add this line</span>
  <span class="n">compile</span> <span class="s2">"com.google.firebase:firebase-core:11.+"</span>
  <span class="n">compile</span> <span class="s2">"com.google.firebase:firebase-messaging:11.+"</span>
<span class="o">}</span>
</code></pre>
</div>

<p>و در نهایت باید گریدل رو Sync کنیم. بعد از اینکه Gradle کتابخونه‌های مد نظرش رو دریافت و آماده استفاده شد میریم سراغ مرحله بعد.</p>

<p>خب، حالا اول از همه در مسیر اپلیکیشن یک دایرکتوری به اسم <code class="highlighter-rouge">PushNotification</code> ایجاد کرده، و در اون یک کلاس به اسم <code class="highlighter-rouge">FCMInstanceIDService</code>، که از <code class="highlighter-rouge">FirebaseInstanceIdService</code> ارث‌بری میکنه، ایجاد میکنیم. این کلاس وظیفه ساخت توکن و بروزرسانی اون درصورتی که اکسپایر شده رو بر عهده داره.</p>

<p>وقتی که کاربر یک توکن دریافت کرده یا توکن قبلی وی باطل و توکن جدید صادر شد، تابع <code class="highlighter-rouge">onTokenRefresh</code> در این کلاس صدا فراخونی میشه. (<a href="https://github.com/sadra/FirebaseApp/blob/master/app/src/main/java/com/isapanah/firebase/PushNotification/FCMInstanceIDService.java">مشاهده کلاس در گیتهاب</a>)</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FCMInstanceIDService</span> <span class="kd">extends</span> <span class="n">FirebaseInstanceIdService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTokenRefresh</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onTokenRefresh</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">refreshedToken</span> <span class="o">=</span> <span class="n">FirebaseInstanceId</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getToken</span><span class="o">();</span>
	<span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>خب بعد از اینکه کاربر توکن دریافت کرد میتونه از سرویس FCM استفاده کنه، پس ما هم باید یه کلاس ایجاد کنیم که پیام‌های دریافتی FCM رو مدیریت کنه. برای این منظور کلاسی به نام <code class="highlighter-rouge">FCMService</code> ایجاد کرده و اون رو  <strong>extend</strong> می‌کنیم از <code class="highlighter-rouge">FirebaseMessagingService</code>.</p>

<p>در این کلاس ما می‌تونیم با استفاده از تابع <code class="highlighter-rouge">onMessageReceived</code> در هنگام دریافت پیامی از FCM اون رو مدیریت کرده و هر بلایی که میخواییم سرش بیاریم 😈 (<a href="https://github.com/sadra/FirebaseApp/blob/master/app/src/main/java/com/isapanah/firebase/PushNotification/FCMService.java">مشاهده کلاس در گیتهاب</a>)</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FCMService</span> <span class="kd">extends</span> <span class="n">FirebaseMessagingService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessageReceived</span><span class="o">(</span><span class="n">RemoteMessage</span> <span class="n">remoteMessage</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"FCM"</span><span class="o">,</span> <span class="s">"New notification from: "</span> <span class="o">+</span> <span class="n">remoteMessage</span><span class="o">.</span><span class="na">getFrom</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>بعد از اینکه دو کلاس <strong>FCMInstanceIDService</strong> و <strong>FCMService</strong> رو آماده کردیم، وقتشه که اونهارو در <code class="highlighter-rouge">AndroidManifest</code> هم به عنوان سرویس رویداد‌های <code class="highlighter-rouge">INSTANCE_ID_EVENT</code> و <code class="highlighter-rouge">MESSAGING_EVENT</code> معرفی کنیم.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- ADD this lines before &lt;/application&gt; close tag --&gt;</span>
<span class="nt">&lt;service</span>
    <span class="na">android:name=</span><span class="s">".PushNotification.FCMInstanceIDService"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.google.firebase.INSTANCE_ID_EVENT"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/service&gt;</span>

<span class="nt">&lt;service</span>
    <span class="na">android:name=</span><span class="s">".PushNotification.FCMService"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.google.firebase.MESSAGING_EVENT"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/service&gt;</span>
</code></pre>
</div>

<p>خب در همینجا هم میتونیم آیکون ناتیفیکیشن و رنگ پیش‌زمینه اون رو در منیفست مشخص کنیم. (<a href="https://github.com/sadra/FirebaseApp/blob/master/app/src/main/AndroidManifest.xml">مشاهده AndroidManifest در گیتهاب</a>)</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- ADD this lines before &lt;/application&gt; close tag --&gt;</span>
<span class="nt">&lt;meta-data</span>
    <span class="na">android:name=</span><span class="s">"com.google.firebase.messaging.default_notification_icon"</span>
    <span class="na">android:resource=</span><span class="s">"@mipmap/ic_launcher"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;meta-data</span>
    <span class="na">android:name=</span><span class="s">"com.google.firebase.messaging.default_notification_color"</span>
    <span class="na">android:resource=</span><span class="s">"@color/colorPrimary"</span> <span class="nt">/&gt;</span>
</code></pre>
</div>

<p>البته این دو متا دیتا فقط برای ورژن های اندروید 21 یعنی Lolipop به بالا کار میکنه!</p>

<h2 id="node-service">سرویس پوش‌ناتیفیکیشن با Node.js</h2>

<p>خب قبل از اینکه بریم سراغ تنظیمات بعدی و آماده‌سازی اپلیکیشن، لازمه که یه سرویسی هم فراهم کنیم برای اینکه بتونیم با استفاده از API گوگل برای تلفن‌های همراهی که اپلیکیشن مارو نصب دارند پیام ارسال کنیم.</p>

<h3 id="prepare-node-service">آماده سازی سرویس Node.js</h3>

<p>من برای اینکه شما درگیر کارهای مربوط به تهیه این سرویس نشید از قبل اون رو با Node.js نوشتم و در <a href="https://github.com/sadra/FCMPushNotification">ریپوزیتوری گیتهاب</a> قرار دادم.
فقط کافیه ترمینال رو باز کرده و با دستور <code class="highlighter-rouge">git clone REPO_ADDRESS</code> اون رو در جایی که میخواهید کلون بگیرید.
بعد از کلون گرفتن (با استفاده از ترمینال یا CMD) وارد دایرکتوری اصلی پروژه node شده و دستور <code class="highlighter-rouge">npm install</code> رو اجرا کنید تا پکیج‌های مورد نیاز رو دانلود کنه. در نهایت بعد از نصب شدن پکیج ها فقط با اجرای دستور <code class="highlighter-rouge">npm start</code> سرویس آماده استفاده ست و با آدرس <code class="highlighter-rouge">http://localhost:3000</code> در دسترس شماست. پس:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>➜  git clone git@github.com:sadra/FCMPushNotification.git
➜  <span class="nb">cd</span> ~/FCMPushNotification
➜  FCMPushNotification git:<span class="o">(</span>master<span class="o">)</span> ✗ npm install
➜  FCMPushNotification git:<span class="o">(</span>master<span class="o">)</span> ✗ npm start
</code></pre>
</div>

<p>اگر فایل <code class="highlighter-rouge">app.js</code> رو در این پروژه باز کنید چند کلید وجود داره، اول از همه لازمه که کلید امنیتی استفاده از FCM رو از کنسول فایربیس پروژتون دریافت کرده و بجای API_KEY قرار بدید. برای دریافت API Key به کنسول فایربیس مراجعه کرده، روی پروژه FirebaseApp، و بعد هم روی منوی پروژه اپ اندروید Firebase کلیک کنید و به Settings این اپ برید.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-6.png" alt="Firebase Cloud Messaging Console" /></p>

<p>در پنجره باز شده به سربرگ Cloud Messaging رفته کد Server Key رو کپی کرده و در پروژه Node.js بجای <code class="highlighter-rouge">API_KEY</code> قرار بدید.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-7.png" alt="Firebase Cloud Messaging Console" /></p>

<p>در بعد از اون هم لازمه توکن اون اپلیکیشنی برای تست استفاده می‌کنید رو برای <code class="highlighter-rouge">USER_KEY</code> مقدار‌دهی کنید. (این گزینه انتخابیست و الزامی نداره، اما بهتره یک یوزر تست داشته باشیم برای جلوگیری از خطاهای انسانی و تست اپ.)</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">/// PATH: ../FCMPushNotification/app.js</span>
<span class="kd">let</span> <span class="nx">API_KEY</span> <span class="o">=</span> <span class="s2">"key="</span><span class="o">+</span><span class="s2">"AAAAr_E2NCM:APA91bEgmznGj0R5PpRg1ek7GKeMmpADJ5Bj..."</span><span class="p">;</span> <span class="c1">// Your FCM server API key</span>
<span class="kd">let</span> <span class="nx">USER_KEY</span> <span class="o">=</span> <span class="s2">"eWRAtJC2zTs:APA91bEZ_zgxYiEWFaxpHI_wMDO5IApmEt..."</span><span class="p">;</span> <span class="c1">// User FCM Token ID</span>
</code></pre>
</div>

<h3 id="using-nodejs">استفاده از سرویس پوش Node.js</h3>

<p>قبل از اینکه به توضیحات استفاده از این سرویس بپردازم لازمه بدونید که ما چند نوع پیام می‌تونیم ارسال کنیم. مطابق با مستندات FCM ما فقط ۲ نوع پیام داریم: <strong>Notification</strong> و <strong>Data</strong>. اما هرکدوم چی هستن و چه فرقی باهم دارن؟</p>

<ul>
  <li>
    <h4 id="node-notification">Notification</h4>

    <p>این نوع پیام فقط ۲ بخش داره، <code class="highlighter-rouge">title</code> و <code class="highlighter-rouge">body</code>. شما فقط می‌تونید یه پیام ساده با یک عنوان و یک متن ارسال کنید که محدودیت کارکتر هم دارید. ساختار این پیام به این شکله:</p>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">notification</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">title</span><span class="p">:</span> <span class="s2">"Title of the notification message"</span><span class="p">,</span>
      <span class="na">body</span><span class="p">:</span> <span class="s2">"This is Body of the notification message."</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<ul>
  <li>
    <h4 id="node-data">Data</h4>

    <p>اما اگر پیام شما از نوع Data باشه، شما این امکان رو دارید که پیامتون رو بصورت JSON و با هر ساختار و مقادیری که دوست دارید ارسال کنید، برای مثال:</p>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">score</span><span class="p">:</span> <span class="s2">"850"</span><span class="p">,</span>
      <span class="na">time</span><span class="p">:</span> <span class="s2">"2:45"</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<ul>
  <li>
    <h4 id="node-combined-message">Combined Message</h4>

    <p>جالب اینجاست که شما می‌تونید هردو نوع Notification و Data رو باهم یکجا بفرستید. برای مثال یه پیام ناتیفیکیشن دارید که میخواهید هم به کاربر پیامی نشون بده هم مقداری رو در دیتابیس اپلیکیشن تغییر بده:</p>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">notification</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">title</span><span class="p">:</span> <span class="s2">"$GOOG up 1.43% on the day"</span><span class="p">,</span>
    <span class="na">body</span><span class="p">:</span> <span class="s2">"$GOOG gained 11.80 points to close at 835.67, up 1.43% on the day."</span>
  <span class="p">},</span>
  <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">stock</span><span class="p">:</span> <span class="s2">"GOOG"</span><span class="p">,</span>
    <span class="na">open</span><span class="p">:</span> <span class="mf">829.62</span><span class="p">,</span>
    <span class="na">close</span><span class="p">:</span> <span class="s2">"635.67"</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>من در این پروژه با استفاده از Express و بر پایه REST API یکسری Route آماده کردم تا شما بتونید بدون دردسر پیام‌هاتون رو ارسال کنید. ما 4 روت داریم، که هرکدوم به ترتیب وظایف زیر رو برعهده دارند:</p>

<ul>
  <li>با این روت می‌تونید یک پیام به صورت notification ساده ارسال کنید.</li>
</ul>

<div class="language-http highlighter-rouge"><pre class="highlight"><code><span class="err">POST /send/notification
</span></code></pre>
</div>

<ul>
  <li>با این روت می‌تونید یک پیام data ساده ارسال کنید.</li>
</ul>

<div class="language-http highlighter-rouge"><pre class="highlight"><code><span class="err">POST /send/data-notification
</span></code></pre>
</div>

<ul>
  <li>توسط این روت یک پیام data برای یک دسته خاص از کاربرانمون که VIP هستند ارسال می‌کنیم (در ادامه توضیح خواهم داد).</li>
</ul>

<div class="language-http highlighter-rouge"><pre class="highlight"><code><span class="err">POST /send/data-notification/VIP
</span></code></pre>
</div>

<ul>
  <li>توسط این روت هم یک پیام combined برای یک دسته خاص از کاربرانمون که VIP هستند ارسال می‌کنیم.</li>
</ul>

<div class="language-http highlighter-rouge"><pre class="highlight"><code><span class="err">POST /send/combined-notification/VIP
</span></code></pre>
</div>

<p>برای استفاده از این روت‌ها می‌تونید از دستور CURL در ترمینال کمک بگیرید. اما من توصیه میکنم از <a href="https://www.getpostman.com/">Postman</a> برای ریکوئست زدن استفاده کنید. کالکشن این ریکوئست‌هارو هم من از قبل برای شما آماده کردم و در پروژه قرار دادم. فقط کافیه از داخل دایرکتوری پروژه، در فولدر postman-export و یا <a href="https://github.com/sadra/FCMPushNotification/blob/master/postman-export/Firebase%20Push%20Notification.postman_collection">از اینجا در ریپوی گیتهاب</a> اون رو دریافت کرده و به <a href="https://www.getpostman.com/docs/postman/collections/data_formats">Postmanتون import</a> کنید. و یا <a href="https://www.getpostman.com/collections/3776ad8010e1b7ae2c6e">از اینجا</a> بطور مستقیم به پست‌منتون اضافه کنید.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-8.png" alt="Firebase Cloud Messaging Console" /></p>

<p>حالا تنها کاری که لازمه انجام بدید اینه که سرویس رو با <code class="highlighter-rouge">npm start</code> اجرا کرده و با Postman ریکوئست‌هاتون رو ارسال کنید. خب کارمون با سرویس Node.js و Postman تا اینجا تموم شد.</p>

<h2 id="prepare-app-for-fcm">آماده سازی اپلیکیشن برای دریافت ناتیفیکیشن</h2>

<p>خب رسیدیم به اصل ماجرا، حالا هم اپلیکیشن آماده است هم سرویس Node.js. اگه پیام رو ارسال کنید اپلیکیشن بدون هیچ مشکلی اون رو دریافت می‌کنه اما چیزی نشون نمیده، چون ما هنوز بهش نگفتیم با پیامی که دریافت کرده چه کاری بکنه.</p>

<h3 id="receiving-notification">دریافت ناتیفیکیشن</h3>

<p>همونطور که در قسمت قبلی گفتم پیام‌ها توسط کلاس <code class="highlighter-rouge">FCMService</code> در تابع <code class="highlighter-rouge">onMessageReceived</code> می‌تونیم دریافت کنیم. و همچنین گفتم که ۲نوع پیام داریم، که یا notification هستند یا data ( و یا هردو باهم ). برای دریافت پیام notification باید تابع <code class="highlighter-rouge">getNotification</code> و برای data از تابع <code class="highlighter-rouge">getData</code> استفاده می‌کنیم.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessageReceived</span><span class="o">(</span><span class="n">RemoteMessage</span> <span class="n">remoteMessage</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"New notification from: "</span> <span class="o">+</span> <span class="n">remoteMessage</span><span class="o">.</span><span class="na">getFrom</span><span class="o">());</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">remoteMessage</span><span class="o">.</span><span class="na">getNotification</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"Notification message: "</span> <span class="o">+</span> <span class="n">remoteMessage</span><span class="o">.</span><span class="na">getNotification</span><span class="o">());</span>
        <span class="n">notificationMessageReceived</span><span class="o">(</span><span class="n">remoteMessage</span><span class="o">.</span><span class="na">getNotification</span><span class="o">().</span><span class="na">getTitle</span><span class="o">(),</span> <span class="n">remoteMessage</span><span class="o">.</span><span class="na">getNotification</span><span class="o">().</span><span class="na">getBody</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">remoteMessage</span><span class="o">.</span><span class="na">getData</span><span class="o">().</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"Data Payload: "</span> <span class="o">+</span> <span class="n">remoteMessage</span><span class="o">.</span><span class="na">getData</span><span class="o">());</span>
        <span class="n">dataMessageReceived</span><span class="o">(</span><span class="n">remoteMessage</span><span class="o">.</span><span class="na">getData</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<p>اگر پیام که ارسال شده از نوع <strong>notification</strong> بود، فقط کافیه title و body رو گرفته و با استفاده از <code class="highlighter-rouge">NotificationCompat</code> اون رو نشون بدیم.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">notificationMessageReceived</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">body</span><span class="o">){</span>

    <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span> <span class="n">notificationBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="n">title</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setAutoCancel</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="n">getNotificationIcon</span><span class="o">())</span>
            <span class="o">.</span><span class="na">setLargeIcon</span><span class="o">(</span><span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">ic_launcher</span><span class="o">))</span>
            <span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">ContextCompat</span><span class="o">.</span><span class="na">getColor</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorPrimary</span><span class="o">));</span>

    <span class="n">NotificationManager</span> <span class="n">notificationManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">NotificationManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">NOTIFICATION_SERVICE</span><span class="o">);</span>
    <span class="n">notificationManager</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="n">getNotify</span><span class="o">(),</span> <span class="n">notificationBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>

<span class="o">}</span>
</code></pre>
</div>

<p>و اگر پیام از نوع <strong>data</strong> بود، با کمک <code class="highlighter-rouge">getData</code> محتوی پیام رو گرفته، به فایل <strong>JSONObject</strong> تبدیل کرده و ازش استفاده می‌کنیم.</p>

<p>من در این پروژه نمونه برای پیام data یک آبجکت بنام <code class="highlighter-rouge">type</code> تعریف کردم. و بر اساس <strong>type</strong> پیامِ دیتا، مشخص میکنم که چه رفتاری باید از اپلیکیشن سر بزنه.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">dataMessageReceived</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Map</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;</span> <span class="n">body</span><span class="o">)</span> <span class="o">{</span>

    <span class="k">try</span><span class="o">{</span>
        <span class="n">JSONObject</span> <span class="n">bodyObjects</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>

        <span class="k">if</span><span class="o">(</span><span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"type"</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="s">"banner"</span><span class="o">)){</span>
            <span class="n">showNotificationWithBanner</span><span class="o">(</span> <span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"title"</span><span class="o">),</span> <span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"message"</span><span class="o">),</span> <span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"banner_url"</span><span class="o">)</span>  <span class="o">);</span>
        <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"type"</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="s">"dialog_message"</span><span class="o">)){</span>
            <span class="n">broadcastTheMessage</span><span class="o">(</span><span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"title"</span><span class="o">),</span> <span class="n">bodyObjects</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"message"</span><span class="o">));</span>
        <span class="o">}</span>

    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span> <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"There is a problem"</span><span class="o">,</span><span class="s">"Exception: "</span><span class="o">+</span><span class="n">e</span><span class="o">);</span> <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<p>اگه type برابر banner باشه، اول پیام رو دریافت کرده، و بعد یه <code class="highlighter-rouge">BigPictureStyle</code> برای <code class="highlighter-rouge">NotificationCompat</code> میسازیم، و در نهایت اون رو به <code class="highlighter-rouge">NotificationCompat.Builder</code> نسبت‌دهی می‌کنیم.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">showNotificationWithBanner</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">String</span> <span class="n">bannerURL</span><span class="o">){</span>

    <span class="c1">//Style for showing notification With Banner</span>
    <span class="n">Bitmap</span> <span class="n">remote_picture</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">gray_banner</span><span class="o">);</span>
    <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">BigPictureStyle</span> <span class="n">notiStyle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">BigPictureStyle</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">remote_picture</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeStream</span><span class="o">((</span><span class="n">InputStream</span><span class="o">)</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">bannerURL</span><span class="o">).</span><span class="na">getContent</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="n">notiStyle</span><span class="o">.</span><span class="na">bigPicture</span><span class="o">(</span><span class="n">remote_picture</span><span class="o">);</span>

    <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span> <span class="n">notificationBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="n">title</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setAutoCancel</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="n">getNotificationIcon</span><span class="o">())</span>
            <span class="o">.</span><span class="na">setLargeIcon</span><span class="o">(</span><span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">ic_launcher</span><span class="o">))</span>
            <span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">ContextCompat</span><span class="o">.</span><span class="na">getColor</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">colorPrimary</span><span class="o">))</span>
            <span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">notiStyle</span><span class="o">);</span>

    <span class="n">NotificationManager</span> <span class="n">notificationManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">NotificationManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">NOTIFICATION_SERVICE</span><span class="o">);</span>
    <span class="n">notificationManager</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="n">getNotify</span><span class="o">(),</span> <span class="n">notificationBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>

<span class="o">}</span>
</code></pre>
</div>

<p>مواقعی هست که ما نمی‌خواهیم پیام دریافتی رو بصورت ناتیفیکیشن دریافت کنیم. بلکه میخوایم مثلا اطلاعات دریافتی رو در دیتابیس ذخیره کنیم، یا میخواهیم چیزی رو به کاربر نشون بدیم. من در این نمونه میخواستم که به کاربر یه دیالوگ نشون بدم.
من مقدار <strong>type</strong> پیام رو برابر <code class="highlighter-rouge">dialog_message</code> گذاشتم. که بعدش تابع <code class="highlighter-rouge">broadcastTheMessage</code> فراخونی میشه، و این تابع دیتای دریافتی رو در داخل اپلیکیشن <strong>BroadCast</strong> میکنه.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">broadcastTheMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">){</span>
    <span class="n">Intent</span> <span class="n">notification</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">FCM_ACTION_NEW_NOTIFICATION</span><span class="o">);</span>
    <span class="n">notification</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="n">title</span><span class="o">);</span>
    <span class="n">notification</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
    <span class="n">LocalBroadcastManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">sendBroadcast</span><span class="o">(</span><span class="n">notification</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<p>خوب وقتشه تظیمات مربوط به اونجایی که قراره دیالوگ رو نشون بده هم انجام بدیم. پس در MainActivity اول میام یه <code class="highlighter-rouge">BroadcastReceiver</code> ایجاد میکنم و بهش میگم هرموقع پیامی دریافت کردی که کلید <strong>FCM_ACTION_NEW_NOTIFICATION</strong> رو داشت، متد مورد نظر من رو صدا کن.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="n">BroadcastReceiver</span> <span class="n">mRegistrationBroadcastReceiver</span><span class="o">;</span>

<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">mRegistrationBroadcastReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BroadcastReceiver</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">switch</span> <span class="o">(</span><span class="n">intent</span><span class="o">.</span><span class="na">getAction</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">case</span> <span class="nl">FCM_ACTION_NEW_NOTIFICATION:</span>
                    <span class="n">showDialog</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span> <span class="c1">//Call the method that shows AlertDialog</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>
</code></pre>
</div>

<p>و بعدش هم در متد <code class="highlighter-rouge">onResume</code> لازمه که بگم این اکتیویتی رو برای پیام برودکست شده ای که کلیدش <strong>FCM_ACTION_NEW_NOTIFICATION</strong> هست، رجیستر کن.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
    <span class="n">LocalBroadcastManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">registerReceiver</span><span class="o">(</span><span class="n">mRegistrationBroadcastReceiver</span><span class="o">,</span> <span class="k">new</span> <span class="n">IntentFilter</span><span class="o">(</span><span class="n">FCM_ACTION_NEW_NOTIFICATION</span><span class="o">));</span>
<span class="o">}</span>
</code></pre>
</div>

<p><strong>نکته:</strong> توجه کنید که رجیستر کردن برای یک برادکست حتما باید بعد از ساختن BroadcastReceiver باشه.</p>

<p>همه چی آمادست. اگه پیام معمولی ارسال کنیم یا بصورت دیتای بنری، به راحتی ناتیفیکیشن رو نشون میده.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-9.png" alt="Firebase Notification" /></p>

<p>و اگر هم نوع پیام data بصورت dialog باشه، برادکست به راحتی دریافت شده و دیالوگ نشون داده میشه.</p>

<p><img src="/assets/img/post/2017-10-24/fcm-11.jpg" alt="Firebase Notification" /></p>

<h3 id="send-and-receive-notification">ارسال و دریافت ناتیفیکیشن برای گروهی از کاربران</h3>

<p>خب تا الان یاد گرفتیم که برای کاربران اپلیکیشنمون ناتیفیکیشن بفرستیم. اما مواقعی پیش میاد که نمیخواییم برای همه کاربرها پیام ارسال کنیم، بلکه میخوایم فقط گروهی از اونها پیام مارو دریافت کنند. اما چطوری؟</p>

<p>ما به دو صورت می‌تونیم پیام ارسال کنیم:</p>

<ol>
  <li>
    <p>ارسال پیام بر اساس توکن کاربر (بصورت فردی یا گروهی)</p>
  </li>
  <li>
    <p>ارسال پیام بر اساس Topic</p>
  </li>
</ol>

<p>تا قبل از این ما بر اساس توکن به کاربر پیام می‌فرستادیم. بهتره یه نگاهی به ساختار ریکوئستی که برای FCM ارسال میکنیم بندازیم:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
   <span class="na">notification</span><span class="p">:</span> <span class="p">{</span>
       <span class="s2">"title"</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
       <span class="s2">"body"</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">message</span>
   <span class="p">},</span>
   <span class="na">to</span> <span class="p">:</span> <span class="nx">USER_KEY</span><span class="p">,</span>
   <span class="c1">// to : TOPIC_GLOBAL,</span>
   <span class="c1">// to : TOPIC_VIP_USER,</span>
   <span class="c1">// condition : "'onscreen' in topics &amp;&amp; 'vip_user' in topics",</span>
<span class="p">};</span>
</code></pre>
</div>

<p>ما در <strong>payload</strong> (درواقع درخواستی که به سمت FCM ارسال میشه)، دو بخش اصلی داریم، اولی <code class="highlighter-rouge">notification</code> یا <code class="highlighter-rouge">data</code> که حامل پیام ما به کاربر هستند و <code class="highlighter-rouge">to</code> یا <code class="highlighter-rouge">condition</code> که مقصد و دریافت کننده پیام رو مشخص میکنه. اما هرکدوم چیکار می‌کنند:</p>

<ul>
  <li>
    <p>مقصد مشخص <strong>to</strong></p>

    <p>ما با دونستن توکن کاربر می‌تونیم پیام رو به یه کاربر خاص یا مجموعه ای از کاربرها ارسال کنیم. برای مثال:</p>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">to</span><span class="err">:</span> <span class="s2">"XXXXX:YYYYYYYUUUUUIIIIOOOOOO"</span><span class="p">,</span>
<span class="c1">//or</span>
<span class="nx">to</span><span class="err">:</span> <span class="p">[</span><span class="s2">"XXXXX:YYYYYYYUUUUUIIIIAAAAA"</span><span class="p">,</span> <span class="s2">"XXXXX:YYYYYYYUUUUUIIIIBBBBB"</span><span class="p">,</span> <span class="s2">"XXXXX:YYYYYYYUUUUUIIIICCCCC"</span><span class="p">]</span>
</code></pre>
</div>

<p>سرویس FCM به ما اجازه می‌ده که کاربرنامون رو در <code class="highlighter-rouge">Topic</code> یا موضوع (و موضوع‌های) خاصی عضو کنیم. و بدین ترتیب پیام فقط برای کاربرانی که در فلان موضوع عضو هستند ارسال بشه. به این منظور مقصد دریافت رو با کلیدواژه <strong>topics</strong> و نام تاپیک می‌نویسیم. برای مثال در زیر، مقصدِ پیام برای کاربرانی که عضو موضوع <code class="highlighter-rouge">vip_user</code> هستند تعریف شده:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">to</span><span class="err">:</span> <span class="s2">"/topics/vip_user"</span>
</code></pre>
</div>

<ul>
  <li>
    <p>مقصد شرطی <strong>condition</strong></p>

    <p>مقصد شرطی یا conditional به ما این امکان رو میده که پیام رو به کاربران بر اساس شرط عضویت اونها در تاپیک‌های خاصی بصورت AND و OR ارسال کنیم. برای مثال در زیر پیام برای کاربرانی که عضو VIP بوده و همچنین خانم هستند ارسال میشه:</p>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">condition</span> <span class="err">:</span> <span class="s2">"'gender_female' in topics &amp;&amp; 'vip_user' in topics"</span>
</code></pre>
</div>

<h3 id="user-topics">ارسال و دریافت ناتیفیکیشن بر اساس Topic یا موضوعی خاص</h3>

<p>در این پروژه ای که برای نمونه ساختم، خواستم پیام برای کاربرانی که درحال حاضر صفحه اپلیکیشنشون باز بوده و از نوع VIP بودن ارسال کنم. پس اول از همه موقعی که اپلیکیشن لانچ شد در متد <code class="highlighter-rouge">onResume</code> اونهارو در تاپیک <code class="highlighter-rouge">onscreen</code> عضو کردم:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
   <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
   <span class="n">FirebaseMessaging</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">subscribeToTopic</span><span class="o">(</span><span class="s">"onscreen"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<p>و وقتی هم میره روی <code class="highlighter-rouge">onPause</code> عضویتش رو از اون تاپیک لغو میکنم:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
   <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
   <span class="n">FirebaseMessaging</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">unsubscribeFromTopic</span><span class="o">(</span><span class="s">"onscreen"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<p>و حالا برای عضویت در حالت VIP یه FloatActionButton ساختم که وقتی کاربر روش کلیک میکنه اون رو عضو VIP کرده یا عضویتش رو لغو میکنه.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">setUserVIP</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">isVIP</span><span class="o">,</span> <span class="n">View</span> <span class="n">view</span><span class="o">){</span>
    <span class="n">getSharedPreferences</span><span class="o">(</span><span class="n">FCM</span><span class="o">,</span> <span class="mi">0</span><span class="o">).</span><span class="na">edit</span><span class="o">().</span><span class="na">putBoolean</span><span class="o">(</span><span class="n">VIP_USER</span><span class="o">,</span> <span class="n">isVIP</span><span class="o">).</span><span class="na">apply</span><span class="o">();</span>
    <span class="n">VIPUser</span><span class="o">.</span><span class="na">setImageResource</span><span class="o">(</span> <span class="n">isVIP</span> <span class="o">?</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">special</span> <span class="o">:</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">not_special</span> <span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">isVIP</span><span class="o">){</span>
        <span class="n">Snackbar</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="s">"You are a VIP user."</span><span class="o">,</span> <span class="n">Snackbar</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
        <span class="n">FirebaseMessaging</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">subscribeToTopic</span><span class="o">(</span><span class="s">"vip_user"</span><span class="o">);</span>
    <span class="o">}</span><span class="k">else</span><span class="o">{</span>
        <span class="n">Snackbar</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="s">"You are a regular user"</span><span class="o">,</span> <span class="n">Snackbar</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
        <span class="n">FirebaseMessaging</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">unsubscribeFromTopic</span><span class="o">(</span><span class="s">"vip_user"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>خب، همه‌چی آمادست، و فقط کافیه از Postman یه ریکئوست روی  <code class="highlighter-rouge">/send/data-notification/VIP</code> بفرستیم، و نتیجه اینکه:</p>

<p><img src="/assets/img/post/2017-10-24/fcm-10.png" alt="Firebase Notification" /></p>

<h3 id="send-message-to-all">ارسال پیام برای همه کاربران</h3>

<p>حالا اگه بخواییم پیام برای همه کاربرا ارسال بشه چی؟ آیا باید توکن همه کابرارو لیست کنیم و بفرستیم؟ نه، نیازی به اینکار نیست! فقط کافیه همون اول که اپلیکیشن کاربر رو عضو تاپیک <code class="highlighter-rouge">global</code> کنید و بدین صورت همه کاربرانتون عضو این تاپیک میشن.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>

    <span class="n">FirebaseMessaging</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">subscribeToTopic</span><span class="o">(</span><span class="s">"global"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<p>وبعد، هرموقع خواستید پیام برای همه کاربران ارسال بشه، فقط کافیه سمت سرور تاپیکِ مقصد رو روی <code class="highlighter-rouge">global</code> ست کنید:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">to</span><span class="err">:</span> <span class="s2">"/topics/global"</span>
</code></pre>
</div>

<h3 id="other-settings">دیگر تنظیمات ارسال پیام</h3>

<p><b id="other-settings-priority">اولویت Priority:</b> شما میتونید برای پیامی که ارسال می‌کنید اولویت گذاری کنید. ما به ازای هر پیام دو اولویت  <code class="highlighter-rouge">normal</code>  و <code class="highlighter-rouge">high</code> داریم.</p>

<ul>
  <li>
    <p>high: این اولویت برای مواقعی‌ست که میخواییم پیام در سریعترین زمان ممکن به دست کاربر برسه،‌و اگر اولویت همین باشه، حتی موقعی که گوشی لاک بوده و اینترنتش برای صرفه‌جویی برق قطع باشه، اینترنت رو وصل میکنه، پیام رو دریافت میکنه و به کاربر نشون میده. این حالت برای اپ‌هایی که پیام‌رسان هستند یا باید پیام همون لحظه به دست کاربر برسه، بیشتر استفاده میشه. در حالت پیشفرض برای پیام‌های notification اولویت روی high قرار داره.</p>
  </li>
  <li>
    <p>normal: این اولویت برای مواقعی‌ست که زمان رسیدن پیام اهمیت نداره،‌و به محض اینکه کاربر گوشیشو از لاک در بیاره و اینترنتش وصل بشه پیام رو بهش نشون میده. درحالت پیشفرض برای پیام‌های data اولویت روی normal قرار داره.</p>

    <p>البته شما‌ می‌تونید خودتون بصورت دستی هم اولویت رو برای اون پیام مشخص کنید.</p>

    <p>برای این منظور در سرویس Node.js و در بخش options، آیتم مربوط به priority رو اضافه می‌کنیم.</p>
  </li>
</ul>

<p><b id="other-settings-time-to-alive">زمان اعتبار پیام timeToLive:</b> ممکن است شما بخوایید برای پیام خودتون اعتبار زمانی اعمال کنید، و اگه پیام تا فلان موقع رسید دست کاربر که هیچ، اگه نرسید دیگه به درد نمیخوره نرسون بهش. بصورت پیشفرض این مقدار روی ۰ قرار داره. سرویس FCM تمام تلاششو میکنه تا پیامتون حتما به کاربر برسه ولی خب اعتقاد داره “Now or Never”، یعنی پیامتون یا همین الان به دست کاربر میرسه یا اصن نمیرسه! 😎
برای این مورد در سرویس Node.js و در بخش options، آیتم مربوط به timeToLive رو اضافه می‌کنیم.</p>

<p><b id="other-settings-collapse-key">کلید جایگزینی پیام collapse_key:</b> البته معنی تحت الفضیه این عبارت میشه (کلید اضمحلال 😐🤣). فرض کنید اولویت پیام درحالت normal قرار داره. یه پیام برای کاربر که میفرستین که مثلا میگه فلان جنس ۲۵٪ تخفیف داره اگه همین الان بخری. بعد نیم‌ساعت تصمیم گرفتین که درصد رو کاهش بدین به ۱۰٪. اونهایی که هنوز پیام رو ندیدن لازم نباشه پیام قبلیو ببینن که گیج بشن، همین ۱۰٪ رو ببینن کافیه. برای اینکار از <code class="highlighter-rouge">collapse_key</code> استفاده می‌کنیم.</p>

<p>هنگامی که اپلیکیشن در حالت Lock قرار داره، پیام رو به کاربر نشون نمیده تا  موقعی که کاربر گوشیشو unlock کنه، اگر پیام جدید با همون کلید دریافت کرد،‌ پیام قبلی رو discard کرده و بجاش این پیام جدید رو نگه می‌داره تا نشون بده.
برای این مورد در سرویس Node.js و در بخش options، آیتم مربوط به collapse_key رو اضافه می‌کنیم.
پس درنهایت مقادیر آپشن میشه:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">method</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
  <span class="na">uri</span><span class="p">:</span> <span class="s1">'https://fcm.googleapis.com/fcm/send'</span><span class="p">,</span>
  <span class="na">body</span><span class="p">:</span> <span class="nx">payload</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">'Content-Type'</span><span class="p">:</span> <span class="s1">'application/json'</span><span class="p">,</span>
      <span class="s1">'Authorization'</span><span class="p">:</span> <span class="nx">API_KEY</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">json</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">priority</span><span class="p">:</span> <span class="s2">"high"</span><span class="p">,</span> <span class="c1">// or set it on -normal- priority</span>
  <span class="na">timeToLive</span><span class="p">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="c1">// this message has 24hours to be expired</span>
  <span class="na">collapseKey</span><span class="p">:</span> <span class="s2">"discount"</span><span class="p">,</span> <span class="c1">//or what ever you want</span>
<span class="p">};</span>
</code></pre>
</div>

<h2 id="conclusion">نتیجه گیری</h2>

<p>فکر نمیکنم دیگه موردی برای گفتن مونده باشه. سعی کردم تمام چیزهایی که لازمه رو ذکر کرده باشم. فقط میمونه ارسال پیام ناتیفیکیشن از داخل خود کنسول فایربیس که اون بمونه بعد از قسمت Analytics بهش می‌پردازم، چون بخش‌هایی از سرویس Analytics در اون دخیل هستند.</p>

<p>امیدوارم به راحتی بتونید از این سرویس استفاده کنید. اگه سوال یا مشکلی بود می‌تونید از طریق <a href="https://twitter.com/sadra_amlashi">توییتر</a> یا <a href="https://t.me/amlashi">تلگرام</a> پیام بدید تا باهم در ارتباط باشیم. 😉</p>

<p>درصورتی که به موارد جدیدی برخوردم، این پست رو به‌روزرسانی خواهم کرد.</p>

        </div>


        <div class="post-routes-list">
            
            <a class="category-link" href="/category/فایربیس">فایربیس</a>
            
            <a class="category-link" href="/category/آموزش">آموزش</a>
            
            
            <a class="tag-link" href="/tag/google">Google</a>
            
            <a class="tag-link" href="/tag/firebase">Firebase</a>
            
            <a class="tag-link" href="/tag/android">Android</a>
            
        </div>


        <div class="Prev-next-post-container">
            
            <a class="previous-btn" href="/2017/set-fire-into-the-problems-with-firebase">نوشته قبلی: با Firebase مشکلاتتان را به آتش بکشید! ←</a>
            
            
            <a class="next-btn" href="/2017/js-promise">→ نوشته بعدی: Promise تابحال هیچوقت انقدر آسون نبوده</a>
            
        </div>


    </div>

</div>

<a id="back-to-top" class="back-to-top" role="button" title="Click to return on the top page" data-toggle="tooltip" data-placement="left" onclick="topFunction()">
    <img src="/assets/img/base/arrow-up.png" class="arrow-up"/>
</a>


        <!-- Footer -->
<footer class="footer-wrapper">

    <div class="delimiter">
        <a href="/" class="footer-logo">
            <img src="isapanah.com/assets/img/base/favicon.png" class="logo-wrapper">
        </a>
    </div>

    <p class="footer-copyright">
        2008 - 2017<br>
        مطالب تحت لیسانس <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/" rel="license" target="_blank">کریتیو کامنز</a> منتشر می‌شوند.

    </p>

    <div class="footer-social-links">
        <a href="https://twitter.com/sadra-amlashi" title="Twitter" target="_blank"><i class="fa fa-twitter"></i></a>
        <a href="https://github.com/sadra" title="Github" target="_blank"><i class="fa fa-github"></i></a>
        <a href="https://medium.com/sadra" title="Medium" target="_blank"><i class="fa fa-medium"></i></a>
        <a href="https://www.linkedin.com/in/amlashisadra/" title="Linkedin" target="_blank"><i class="fa fa-linkedin"></i></a>
        <a href="https://facebook.com/sadra.am123" title="Facebook" target="_blank"><i class="fa fa-facebook"></i></a>
    </div>


 </footer>
<!-- /Footer -->

        
    </body>
</html>
