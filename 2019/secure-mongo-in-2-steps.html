<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" dir="rtl" lang="fa-IR">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" dir="rtl" lang="fa-IR">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html dir="rtl" lang="fa-IR">
<!--<![endif]-->
    <head>
        <meta charset="utf-8"/>
<meta content="IE-edge,chrome=1" http-equiv="X-UA-Compatable"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="keywords" content="Mongo,NodeJs,Mongoose,Security,Docker,ุฏุงฺฉุฑ, Mongo,Database,Docker"/>
<meta name="author" content="Sadra Isapanah Amlashi | ุตุฏุฑุง ุนุณ ูพูุงู ุงููุด"/>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script>
    (function(b,l,e,g,h,f){1!==parseInt(e.msDoNotTrack||b.doNotTrack||e.doNotTrack,10)&&b.addEventListener("load",function(){var r=(new Date).getTime();b.galite=b.galite||{};var m=new XMLHttpRequest,n="https://www.google-analytics.com/collect?cid="+(l.uid=l.uid||Math.random()+"."+Math.random())+"&v=1&tid="+galite.UA+"&dl="+f(h.location.href)+"&ul=en-us&de=UTF-8",a=function(b){var d="",c;for(c in b){if(void 0===b[c])return!1;d+=f(b[c])}return d},p={dt:[h.title],sd:[g.colorDepth,"-bit"],sr:[g.availHeight,
        "x",g.availWidth],vp:[innerWidth,"x",innerHeight],dr:[h.referrer]},k;for(k in p){var q=k+"="+a(p[k]);q&&(n+="&"+q)}a=function(b,d){var c="",a;for(a in d)c+="&"+a+"="+f(d[a]);return function(){var a=n+c+(galite.anonymizeIp?"&aip=1":"")+"&t="+f(b)+"&z="+(new Date).getTime();if(e.sendBeacon)e.sendBeacon(a);else try{m.open("GET",a,!1),m.send()}catch(t){(new Image).src=a}}};setTimeout(a("pageview",null),100);b.addEventListener("unload",a("timing",{utc:"JS Dependencies",utv:"unload",utt:(new Date).getTime()-
    r}))})})(window,localStorage,navigator,screen,document,encodeURIComponent);

    var galite = galite || {};
    galite.UA = 'UA-107934487-1'; // Insert your tracking code here
</script>

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@sadra_amlashi" />
<meta name="twitter:creator" content="@sadra_amlashi" />

<meta property="og:type" content="website" />
<meta property="og:locale" content="fa_IR" />
<meta property="og:url" content="https://isapanah.com/2019/secure-mongo-in-2-steps" />


<meta name="description" content="ุฏุฑ ุงู ูพุณุช ุณุน ฺฉุฑุฏู ุฏุฑ ฺูุฏ ฺฏุงู ุนูู ููุงุฑุฏ ุฑู ุฐฺฉุฑ ฺฉูู ฺฉู ุจุชููุฏ ุจูุงุณุทูโ ุงูููุง ุฏุชุงุจุณ Mongo ุฎูุฏุชูู ุฑู ุงููโุชุฑ ฺฉูุฏ."/>
<meta property="og:description" content="ุฏุฑ ุงู ูพุณุช ุณุน ฺฉุฑุฏู ุฏุฑ ฺูุฏ ฺฏุงู ุนูู ููุงุฑุฏ ุฑู ุฐฺฉุฑ ฺฉูู ฺฉู ุจุชููุฏ ุจูุงุณุทูโ ุงูููุง ุฏุชุงุจุณ Mongo ุฎูุฏุชูู ุฑู ุงููโุชุฑ ฺฉูุฏ."/>
<meta name="twitter:description" content="ุฏุฑ ุงู ูพุณุช ุณุน ฺฉุฑุฏู ุฏุฑ ฺูุฏ ฺฏุงู ุนูู ููุงุฑุฏ ุฑู ุฐฺฉุฑ ฺฉูู ฺฉู ุจุชููุฏ ุจูุงุณุทูโ ุงูููุง ุฏุชุงุจุณ Mongo ุฎูุฏุชูู ุฑู ุงููโุชุฑ ฺฉูุฏ."/>




<title>ุงูู ฺฉุฑุฏู MongoDB ุฏุฑ ุฏู ฺฏุงู | ุตุฏุฑุง ุงููุด</title>
<meta property="twitter:title" content="ุงูู ฺฉุฑุฏู MongoDB ุฏุฑ ุฏู ฺฏุงู | ุตุฏุฑุง ุงููุด"/>
<meta property="og:site_name" content="ุงูู ฺฉุฑุฏู MongoDB ุฏุฑ ุฏู ฺฏุงู | ุตุฏุฑุง ุงููุด"/>
<meta property="og:title" content="ุงูู ฺฉุฑุฏู MongoDB ุฏุฑ ุฏู ฺฏุงู | ุตุฏุฑุง ุงููุด"/>



<meta property="twitter:image" content="https://isapanah.com/assets/img/post/2019-04-19/secure-mongo-cover.png" />
<meta property="og:image" content="https://isapanah.com/assets/img/post/2019-04-19/secure-mongo-cover.png" />


<link rel="alternate" type="application/rss+xml" title="ูุจูุงฺฏ ุตุฏุฑุง ุงููุด ยป Feed" href="/site-map.xml"/>
<link rel="alternative" href="/site-map.xml" title="ูุจูุงฺฏ ุตุฏุฑุง ุงููุด" type="application/atom+xml"/>
<link rel="short icon" type="image/x-icon" href="https://isapanah.com/assets/img/base/favicon.png"/>
<link rel="stylesheet" type="text/css" href="https://isapanah.com/assets/css/styles.css"/>
    </head>

    <body dir="rtl" lang="Farsi" >
        <!-- Header -->
<header class="header-rtl">
    <nav class="nav-wrap">
        <a href="/" class="nav-logo">ูุจูุงฺฏ ุตุฏุฑุง ุงููุด</a>
        <ul class="navigation">

            <li><a href="/">ุงุฏุฏุงุดุชโูุง</a></li>
            <li><a href="/list/items">ููุถูุนุงุช</a></li>
            <li><a href="/about">ุฏุฑุจุงุฑู</a></li>
            <li><a href="http://cv.isapanah.com/">ุฑุฒููู</a></li>
            <li><a href="https://sadra.github.io/english">English</a></li>

        </ul>
    </nav>
</header>
<!-- /Header -->

        <script xmlns:date="http://www.w3.org/1999/xhtml">

    window.onscroll = function() {scrollFunction()};

    function scrollFunction() {
        document.getElementById("back-to-top").style.display = (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) ? "block" : "none";
    }

    function topFunction() {
        document.body.scrollTop = 0; // For Safari
        document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    }

</script>


<div class="content">

    <div class="blog-post-container">

        <div class="post-title-container">
            <h1 class="post-title">ุงูู ฺฉุฑุฏู MongoDB ุฏุฑ ุฏู ฺฏุงู</h1>
        </div>

        <div class="post_created">

            <div class="author_avatar">
                <img src="/assets/img/base/avatar.jpg" alt="ุตุฏุฑุง ุงููุด" id="avatar-img" />
            </div>

            <div class="post_info">
                <p> <a href="/about">ุตุฏุฑุง ุงููุด</a> </p>
                <small>ุชูุณุนู ุฏููุฏู</small><br/>
                <small>ุฌูุนู 30 ูุฑูุฑุฏู 1398</small>
            </div>

        </div>

        
        <div class="post-cover">
            <img src="https://isapanah.com/assets/img/post/2019-04-19/secure-mongo-cover.png" alt="ุงูู ฺฉุฑุฏู MongoDB ุฏุฑ ุฏู ฺฏุงู">
        </div>
        

        <div class="post-content">
            <h2 id="ููุฏูู">ููุฏูู</h2>

<p>ุจุนุฏ ุงุฒ ุงุชูุงู ฺฉู ุฏุฑูุฒ ุจุฑุง <a href="https://tap30.ir/">TAP30</a> ุงุชูุงู ุงูุชุงุฏุ ุชุตูู ฺฏุฑูุชู ุจุฑู ุณุฑุงุบ ุฏุชุงุจุณุง ูููฺฏู ุฎูุฏู ู ุงููุงุฑู ุจุฑุฑุณ ฺฉุฑุฏู ู ฺฉุฑุฏูุดุงู ูุงุดูู ุฑู ุณุช ฺฉูู. (ุงูุจุชู ูฺฏุฑุงู ูุจุงุดูุ ุฏุชุงูุง ููุฌูุฏ ุฑู ุฏุชุงุจุณ ูู ุงุตูุง ฺุฒ ูุงุจู ุฏุงุฑ ูุจูุฏู ู ูููโุด ุฏุชุง ุชุณุช ูุงุณู ฺฉุงุฑุง ุชุณุชู ๐ฌ)</p>

<p>ุงฺฏู ููุฏููู ฺู ุงุชูุงู ุฑุฎ ุฏุงุฏูุ ุฎุจ ููู ุญูุตููโุดู ูุฏุงุฑู ุจุฑุงุชูู ุชูุถุญ ุจุฏูุ ููุท ุจฺฏู ฺฉู ูุงุฌุฑุง ุงุฒ ูู ุฑูุชู ูุฒุฏฺฉ ุจู ถ ูููู ุฏุชุงุณูุช ุงุฒ ฺฉ ุงุฒ ุฏุชุงุจุณโูุง ุฏุฑ ุงุฑุงู ุจูุฏู ฺฉู ูพูุฑุชุด ุจุงุฒ ุจูุฏู ู ููุชูุฑูุง ุฌุณุชุฌูฺฏุฑ ุฏุชุงุจุณ ุงูู ุฑู ุงูุฏฺฉุณ ฺฉุฑุฏู ุจูุฏู ฺฉู <a href="https://twitter.com/MayhemDayOne/status/1118764251051626501">ุขูุง ุจุงุจ ุฏุงฺูฺฉู ุฏุฑ ุงู ุชูุช</a> ูุงุฌุฑุง ูพุฏุง ฺฉุฑุฏู ุงููุงุฑู ุชูุถุญ ุฏุงุฏู:</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">More than 6.7M Iranian IDs exposed: names, SSN, phone numbers. Reported to Iranian CERT, but if you have a better contact please let me know. <a href="https://t.co/seZA4O7Aeu">pic.twitter.com/seZA4O7Aeu</a></p>&mdash; Bob Diachenko (@MayhemDayOne) <a href="https://twitter.com/MayhemDayOne/status/1118764251051626501?ref_src=twsrc%5Etfw">April 18, 2019</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>ุงุทูุงุนุงุช ฺฉุงูู ุฑุงุฌุน ุจู ุงู ูุถู ุฑู ุงุฒ  <a href="https://twitter.com/nima/status/1118814696017211392">ุงู ุฑุดุชู ุชูุช ููุง ุงฺฉุจุฑ ูพูุฑ</a> ูู ูโุชููุฏ ุฏูุจุงู ฺฉูุฏ:</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="fa" dir="rtl">ุงุทูุงุนุงุช ุจุด ุงุฒ ถ.ท ูููู ุดูุงุณู ุงุฑุงู ุดุงูู ูุงูุ ุดูุงุฑู ูู ู ุดูุงุฑู ุชููู ููุชุดุฑ ุดุฏู. <a href="https://t.co/pIm7R4zNrO">https://t.co/pIm7R4zNrO</a></p>&mdash; Nima Akbarpour ููุง (@nima) <a href="https://twitter.com/nima/status/1118814696017211392?ref_src=twsrc%5Etfw">April 18, 2019</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>ุงุฒ ุฎูุฏ ูุงุฌุฑุง ฺฉู ุจฺฏุฐุฑู ุจูุชุฑู ุจุฑู ุณุฑุงุบ ุจุญุซ ุฎูุฏููู. ุงููู ุงุดุชุจุงู ฺฉู ฺฉู ุณูู ูู ุจูุฏู (ุงูุดุงููู)ุ ูุทุนุง ุงู ุจูุฏู ฺฉู ูพูุฑุช ูุฑุจูุท ุจู ุฏุชุงุจุณ ููุฑุฏ ูุธุฑ ุฑู ูููุฌูุฑ ุจุงุฒ ฺฏุฐุงุดุชู ุจูุฏู! ๐</p>

<p><img src="/assets/img/post/2019-04-19/secure-mongo-8.gif" alt="secure-mongo-8" /></p>

<p>ุงููู ฺฏุงู ุงูู ฺฉู ูพูุฑุช ุฏุชุงุจุณุชูู ุฑู ูุจู ุงุฒ ูุฑฺุฒ ุจุจูุฏู ูุทูุง. (ูฺฏุฑ ุงูฺฉู ุฒูุงู ุฎุงุต ุจุฎูุงู ุฑู ฺฉูุงูุช GUI ุฏุณฺฉุชุงูพ ฺุฒ ุจุฎูุงู ุจูุด ูุตู ุจุดูุ ููุท ุชู ูููู ุจุงุฒูโ ุฒูุงู ุจุฒุงุฑู ุจุงุฒ ุจูููู). ูพุณ:</p>

<h2 id="ฺฏุงู-ุงูู-ุจุณุชู-ูพูุฑุชูุง-ุฏุชุงุจุณ">ฺฏุงู ุงูู: ุจุณุชู ูพูุฑุชโูุง ุฏุชุงุจุณ</h2>

<p>ุจุฑุง ุงูฺฉุฑ ููุท ฺฉุงูู ูุงุฑูุงู ุณุฑูุฑ ูููฺฉุณุชูู ุฑู ูุนุงู ฺฉุฑุฏู ู ุจุง ุฏุณุชูุฑ ุฒุฑ ูพูุฑุช ููุฑุฏ ูุธุฑ ุฑู ุจุจูุฏู:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>sudo ufw <span class="nb">enable
</span>sudo ufw deny 27017 <span class="c">#or any other port</span>
</code></pre>
</div>

<p>ุงฺฏู ุฎูุงุณุชู ูพูุฑุช ุฑู ุจุฑุง ุฏูุงู ุจุงุฒ ฺฉููุ ููุท ฺฉุงูู ุงุฌุงุฒู ุฏุณุชุฑุณ ุจุฏู ุจูุด ุจุง ููู ูู ุฎุท ุฏุณุชูุฑ:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>sudo ufw allow 27017
</code></pre>
</div>

<h2 id="ฺฏุงู-ุฏูู-ุงุฌุงุฏ-ุณุทุญ-ุฏุณุชุฑุณ-ุจุง-ุงุญุฑุงุฒ-ููุช-ุจู-ุฏุชุงุจุณ">ฺฏุงู ุฏูู: ุงุฌุงุฏ ุณุทุญ ุฏุณุชุฑุณ ุจุง ุงุญุฑุงุฒ ููุช ุจู ุฏุชุงุจุณ</h2>

<p>ฺฉุงุฑ ุฏูู ฺฉู ุจุงุฏ ุจฺฉูู ุงูู ฺฉู ุจุฑุง ุฏุชุงุจุณุชูู ุฏุฑ ุณุทูุญ ูุฎุชูู <code class="highlighter-rouge">ูุฒุฑ</code> ุจุง ููุดโูุง ูุฑุทุจุช ู ูุงุฒูู ุงุฌุงุฏ ฺฉูุฏ. ุงู ฺฉุงุฑู ุฏุฑ ฺูุฏ ูุฑุญูู ุงูุฌุงู ุจุงูู ุงูุฌุงูุด ูุฏู. ูุจู ุงุฒ ุดุฑูุน ุจฺฏู ฺฉู ุงู ุขููุฒุด ุฑู ุจุฑ ุงุณุงุณ ุฑุงู ุงูุฏุงุฒ ฺฉ ุฏุชุงุจุณ Mongo ุฑู Docker ูุฑุงุฑู ุงูุฌุงู ุจุฏู:</p>

<h3 id="ูุฑุญูู-ุงูู-ุฑุงู-ุงูุฏุงุฒ-ฺฉุงูุชุฑูุฑ-mongo-ุจุฑ-ูุจูุง-auth">ูุฑุญูู ุงูู: ุฑุงู ุงูุฏุงุฒ ฺฉุงูุชุฑูุฑ Mongo ุจุฑ ูุจูุง auth</h3>

<p>ุงฺฏุฑ ฺฉุงูุชูุฑ ูููฺฏู ุฑู ุจุง ุงุณุชูุงุฏู ุงุฒ ุชฺฏ <code class="highlighter-rouge">--auth</code> ุฑุงู ุงูุฏุงุฒู ฺฉูุฏุ ุงู ุงูฺฉุงู ุฑู ูุฏู ุจู ูููฺฏู ฺฉู ุฎูุฏุดู ุขูุงุฏู ฺฉูู ุจุฑุง ุณฺฉูุฑ ุดุฏู. ูพุณุ ุงุฒ ุฏุณุชูุฑ ุฒุฑ ุงุณุชูุงุฏู ูโฺฉูู:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>docker run -d --name CONTAINER_NAME -v VOLUME:/data/db -p PORT:27017 mongo --auth
</code></pre>
</div>

<p>ู ุจุนุฏุ ุจุง ุฏุณุชูุฑ ูพุงู ูุงุฑุฏ ุดู mongo ูุดู ฺฉู ุฏุณุชูุฑุงุช ุจุนุฏ ุฑู ูุงุฑุฏ ฺฉูู:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>docker <span class="nb">exec</span> -it CONTAINER_NAME mongo admin
</code></pre>
</div>

<h3 id="ูุฑุญูู-ุฏูู-ุงุฌุงุฏ-ฺฉุงุฑุจุฑ-admin">ูุฑุญูู ุฏูู: ุงุฌุงุฏ ฺฉุงุฑุจุฑ admin</h3>

<p>ุฏุฑ ุงู ูุฑุญูู ุจุงุฏ ุฏุชุงุจุณููู ู ูุฒุฑ ุงุฏูู ุชุนุฑู ฺฉูู ฺฉู ุฏุณุชุฑุณ ุงุฏูู ุจู ฺฉู ุฏุชุงุจุณ ุฏุงุฑู. ุงูู ุงุฒ ููู ุฏุชุงุจุณ ุงุฏูู ุฑู use ูโฺฉูู:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>use admin
</code></pre>
</div>

<p>ฺฉู ุจูููู ุฌูุงุจ ูุฏู:</p>

<p><img src="/assets/img/post/2019-04-19/secure-mongo-1.png" alt="secure-mongo-1" /></p>

<p>ู ุจุนุฏ ุจูุด ูฺฏู ฺฉู ู ูุฒุฑ admin ุจุง ููุด <code class="highlighter-rouge">userAdminAnyDatabase</code> ุฑู ุฏุชุงุจุณ <code class="highlighter-rouge">admin</code> ุจุฑุงููู ุงุฌุงุฏ ฺฉู:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>db.createUser<span class="o">(</span>
	<span class="o">{</span>
		user: <span class="s2">"admin"</span>,
    	<span class="nb">pwd</span>: <span class="s2">"PASS"</span>,
	    roles:[
	    	<span class="o">{</span>
	    		role: <span class="s2">"userAdminAnyDatabase"</span>,
	        db: <span class="s2">"admin"</span>
	    	<span class="o">}</span>
	    <span class="o">]</span>
  	<span class="o">}</span>
<span class="o">)</span>;
</code></pre>
</div>

<p>ู ุญุชูุง ุฌูุงุจ ูุฏู ฺฉู:</p>

<p><img src="/assets/img/post/2019-04-19/secure-mongo-2.png" alt="secure-mongo-2" /></p>

<p>ฺฉู ุงูฺฉ ูู ูุฒุฑ ุงุฏูู ุฑู ุจุฑุงุชูู ุณุงุฎุชู. ุจุนุฏุด ุจุงุฏ ุจุฑู ุชุณุช ฺฉูู ฺฉู ูุง ูุชููู ุจุง ุงู ูุฒุฑ ุงุฏูู ฺฉู ุชุนุฑู ฺฉุฑุฏู ุจู ุณุณุชู ูุงุฑุฏ ุดู. ุจุฑุง ุงู ฺฉุงุฑ ฺฉุงูู ุงุฒ ุฏุณุชูุฑ <code class="highlighter-rouge">db.auth</code> ุงุณุชูุงุฏู ฺฉูู:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>db.auth<span class="o">(</span><span class="s2">"admin"</span>,<span class="s2">"PASS"</span><span class="o">)</span>
</code></pre>
</div>

<p>ู ุงฺฏู ูุดุฎุตุงุช ุฑู ุฏุฑุณุช ูุงุฑุฏ ฺฉุฑุฏู ุจุงุดูุ ุงููู ุฏุฑ ุฌูุงุจ ุจุงุฏ ุจฺฏู <code class="highlighter-rouge">1</code> ฺฉู ุนู ุจูุฑูุงู ุชู ุณุฑูุฑ ูู ๐:</p>

<p><img src="/assets/img/post/2019-04-19/secure-mongo-3.png" alt="secure-mongo-3" /></p>

<p>ุจุนุฏ ุงุฒ ุงูฺฉู ุงูฺฉุงุฑุงุฑู ุงูุฌุงู ุฏุงุฏู. ุจุง ุฏุณุชูุฑ <code class="highlighter-rouge">exit</code> ูุงู ุจุฑูู ุงุฒ ุดูุ ู ู ุจุงุฑ ฺฉุงูุชุฑูุฑ ุฑู ุฑ ุงุณุชุงุฑุช ูโฺฉูู ุชุง ุจุง ูุฒุฑ ุงุฏูู ุฎูุฏุดู ุณูฺฉ ฺฉูู ู ุจุงุฏ ุจุงูุง. ุฏูุจุงุฑู ุจุนุฏ ุฏูุจุงุฑู ุจุง ูููู ุฏุณุชูุฑ ฺฉู ุฏุฑ ูุฑุญูู ุงูู ฺฏูุชู ูุงุฑุฏ ุดู ูููฺฏู ูุดู ุชุง ฺฉุงุฑุง ุจุนุฏ ุฑู ุงูุฌุงู ุจุฏู.</p>

<h3 id="ูุฑุญูู-ุณู-ุงุฌุงุฏ-ฺฉุงุฑุจุฑ-ุจุง-ุฏุณุชุฑุณ-ูุญุฏูุฏ-ุฑู-ฺฉ-ุฏุชุงุจุณ-ุฎุงุต">ูุฑุญูู ุณู: ุงุฌุงุฏ ฺฉุงุฑุจุฑ ุจุง ุฏุณุชุฑุณ ูุญุฏูุฏ ุฑู ฺฉ ุฏุชุงุจุณ ุฎุงุต</h3>

<p>ุญุงูุง ููุชุดู ฺฉู ู ฺฉุงุฑุจุฑ ุจุง ุฏุณุชุฑุณ <code class="highlighter-rouge">Read.write</code>ุจุฑุง ุงูู ุฏุชุงุจุณ ููุฑุฏ ูุธุฑููู ุงุฌุงุฏ ฺฉูู.</p>

<p>ุงุจุชุฏุง ุงุฏูู ุฑู use ฺฉูู:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>use admin
</code></pre>
</div>

<p>ุจุนุฏ ุจุง ุงุฏูู ุฎูุฏููู ุฑู ุงุญุฑุงุฒ ููุช ฺฉูู ุจุฑุง ูููฺฏู:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>db.auth<span class="o">(</span><span class="s2">"admin"</span>,<span class="s2">"PASS"</span><span class="o">)</span>
</code></pre>
</div>

<p>ุญุงูุง ุจุงุฏ ุฏุชุงุจุณ ููุฑุฏ ูุธุฑููู ุฑู use ฺฉูู (ููู ูุณุช ฺฉู ุฏุชุงุจุณ ูุจูุง ุจูุฏู ุง ูุฑุงุฑู ุจุนุฏุง ุณุงุฎุชู ุดูุ ููุท ูุทุฆู ุดู ุงุณู ุฏุชุงุจุณ ููุฑุฏ ูุธุฑ ุฑู ุฏุฑุณุช ูุงุฑุฏ ู ฺฉูู):</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>use my_database
</code></pre>
</div>

<p>ุฏููุง ูููุฌุง ุจุงุฏ ู ฺฉุงุฑุจุฑ ุจุณุงุฒู ุจุฑุง ุงู ุฏุชุงุจุณ ฺฉู ุจู ุงู ุฏุชุงุณ ุฏุณุชุฑุณ ุฏุงุฑู ู ููุด ุงูู ูู ุฏุฑ ูููู ุญุฏ <code class="highlighter-rouge">Read/Write</code> ูุณุช. ุจุฑุง ุงูฺฉุงุฑ ูุซู ุชุนุฑู ูุฒุฑู ุงุฏูู ุนูู ูโฺฉูู:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>db.createUser<span class="o">(</span>
	<span class="o">{</span>
		user: <span class="s2">"USE_NAME"</span>,
	    <span class="nb">pwd</span>: <span class="s2">"USER_PASS"</span>,
	    roles:[
	    	<span class="o">{</span>
	    		role: <span class="s2">"readWrite"</span>, <span class="c">#pay attention to role</span>
	        db: <span class="s2">"DATABASE_NAME"</span>
	    	<span class="o">}</span>
	    <span class="o">]</span>
  	<span class="o">}</span>
<span class="o">)</span>;
</code></pre>
</div>

<p>ู ุฌูุงุจ ุดู ูู ุจู ูุง ุงู ุฎูุงูุฏ ุจูุฏ ุนุฒุฒุงู:</p>

<p><img src="/assets/img/post/2019-04-19/secure-mongo-4.png" alt="secure-mongo-4" /></p>

<p>ู ุจุนุฏุด ูู ู ุจุงุฑ ุชุณุช ูโฺฉูู ุชุง ูุทุณูุฆู ุดู ฺฉู ูุฒุฑููู ุจู ุฏุฑุณุช ูุดุฎุตุงุชุด ุณุช ุดุฏู:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>db.auth<span class="o">(</span><span class="s2">"my_user"</span>, <span class="s2">"my_user_pass"</span><span class="o">)</span>
</code></pre>
</div>

<p>ู ูุชุฌู ููููุช ุขูุฒ ุงุญุฑุงุฒ ููุชููู:</p>

<p><img src="/assets/img/post/2019-04-19/secure-mongo-5.png" alt="secure-mongo-5" /></p>

<p>ุฎุจ ุญุงูุง ู ูุฒุฑ ุณุงุฎุชู ฺฉู ุจู ุฏุชุงุจุณ <code class="highlighter-rouge">my_database</code> ุชููุง ู ุชููุง ุฏุณุชุฑุณ <code class="highlighter-rouge">Read/Write</code> ุฏุงุฑูุ ุงูู ูู ุจุง ฺฉุฑุฏูุดุงู ฺฉู ุจุฑุงุด ุณุช ฺฉุฑุฏู.</p>

<h3 id="ูุฑุญูู-ฺูุงุฑ-ูุตู-ุดุฏู-ุจู-ุฏุชุงุจุณ-mongo-ุจุง-ุงุณุชูุงุฏู-ุงุฒ-ฺฉุงุฑุจุฑ-ุชุนุฑู-ุดุฏู">ูุฑุญูู ฺูุงุฑ: ูุตู ุดุฏู ุจู ุฏุชุงุจุณ mongo ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉุงุฑุจุฑ ุชุนุฑู ุดุฏู</h3>

<p>ุงุฒ ุญุงูุง ุจู ุจุนุฏ ุญุช ุงฺฏู ูพูุฑุช ูู ุจุงุฒ ุจุงุดูุ ุจุฑุง ูุตู ุดุฏู ุจู ุฏุชุงุจุณ ุจุงุฏ ุงุฒ ฺฉุฑุฏูุดุงู ููุฑุฏ ูุธุฑ ุงุณุชูุงุฏู ฺฉุฑุฏุ ูฺฏุฑูู ุญู ุฏุณุชุฑุณ ุจู ุฏุชุงุจุณ ุฑู ูุฏุงุฑุฏ.</p>

<p>ุจุฑุง ุชุณุช ุงู ููุถูุน ูู ุงุฒ ูุงุจุฑุฑ <a href="https://www.npmjs.com/package/mongoose">mongoose</a> ุงุณุชูุงุฏู ฺฉุฑุฏู.</p>

<p>ุฎุจ ุชู ูพุฑูฺู ููุฑุฏ ูุธุฑ ุจุนุฏ ุงุฒ install ฺฉุฑุฏู ูุงุจุฑุฑ ุชูุณุท <code class="highlighter-rouge">npm</code> ุง <code class="highlighter-rouge">yarn</code> ุงูู ุฑู ุจู ูพุฑูฺู ุงููพูุฑุช ฺฉูุฏ:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// Using Node.js `require()`</span>
<span class="kr">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mongoose'</span><span class="p">);</span>
 
<span class="c1">// Using ES6 imports</span>
<span class="kr">import</span> <span class="nx">mongoose</span> <span class="nx">from</span> <span class="s1">'mongoose'</span><span class="p">;</span>
</code></pre>
</div>

<p>ู ุจุนุฏุด ุจุงุฏ ุจุฑุง ูุตู ุดุฏู ุจู ุฏุชุงุจุณ ุจุง ุงุณุชูุงุฏู ุงุฒ ุงูฺฏู ุฒุฑ ุงุฒ ูุชุฏ mongo.connect ุงุณุชูุงุฏู ฺฉูุฏ:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="s1">'mongodb://$USERNAME:$PASSWORD@localhost:$PORT/$DB_NAME?authMechanism=$HASH_MECHANISM'</span>
</code></pre>
</div>

<p>ุง:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="s1">'mongodb://localhost:$PORT/$DB_NAME?authMechanism=$HASH_MECHANISM'</span><span class="p">,</span> <span class="p">{</span>
	<span class="na">username</span><span class="p">:</span> <span class="s2">"$USERNAME"</span><span class="p">,</span>
  <span class="na">password</span><span class="p">:</span> <span class="s2">"$PASSWORD"</span>
<span class="p">})</span>
</code></pre>
</div>

<p>ฺฉู ูู ุฎูุฏู ุญุงูุช ุงูู (ฺฉู ุจูุด ูฺฏู <code class="highlighter-rouge">string</code> ููุฏ) ุฑู ุชุฑุฌุญ ูุฏู.</p>

<p>ุญุชูุง ุญุชูุง ุญุชูุงุ ููุงุณุชูู ุจุงุดู ฺฉู ูฺฉุงูุณู ูุด ฺฉุฑุฏู ูุดุฎุตุงุช auth ุฑู ุจุงุฏ ุณุช ฺฉูู. ุฏุฑ ุญุงูุช ูพุดูุฑุถ ุงุฒ ูฺฉุงูุณู <code class="highlighter-rouge">SCRAM-SHA-1</code> ุงุณุชูุงุฏู ูุดู ูฺฏู ุงูฺฉู ุชู ุชูุธูุงุช ูููฺฏูุชูู ุชุบุฑุงุช ุงุฌุงุฏ ฺฉุฑุฏู ุจุงุดู. ุงฺฏู ุงูฺฉุงุฑ ุฑู ูฺฉูุฏ ูุทุนุง ุจุง ุฎุทุง ูุนุฑูู ุฒุฑ ุจุฑุฎูุฑุฏ ูโฺฉูุฏ:๐ฑ</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>MongoError: Authentication failed.
</code></pre>
</div>

<p>ุฏุฑ ููุงุช ฺฉุฏ ฺฉู ูุงุฑู ูุตู ูฺฉูู ุจู ุฏุชุงุจุณ ูููฺฏูููู ุงูู:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">mongoose</span><span class="p">.</span><span class="nx">Promise</span> <span class="o">=</span> <span class="nx">global</span><span class="p">.</span><span class="nx">Promise</span><span class="p">;</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">await</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">'mongodb://my_user:my_user_pass@localhost:27017/my_db?authMechanism=SCRAM-SHA-1'</span><span class="p">,</span> 
    <span class="p">{</span>
        <span class="na">useNewUrlParser</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">keepAlive</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">connectTimeoutMS</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span> <span class="c1">// Give up initial connection after 10 seconds</span>
        <span class="na">socketTimeoutMS</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span> <span class="c1">// Close sockets after 45 seconds of inactivity</span>
    <span class="p">});</span>
    
    <span class="kr">const</span> <span class="nx">Test</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">'Test'</span><span class="p">,</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="nb">String</span> <span class="p">}));</span>
    <span class="kr">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Test</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'Val'</span> <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Mongo connection Result: '</span><span class="o">+</span><span class="nx">doc</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">run</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">stack</span><span class="p">));</span>
</code></pre>
</div>

<p>ู ููุท ฺฉุงูู ฺฉุฏ ุงุฌุฑุง ุจุดู ู ูุง ุจุง ุฏุฏู ูพุงู ุฒุฑ ูุชูุฌู ูุดู ฺฉู ุงุชุตุงู ุงูู ุจู ุฏุชุงุจุณููู ุจุง ููููุช ุงูุฌุงู ุดุฏู (ุงูุจุชู ุจุฏูู ูุฒุฑ ูพุณูุฑุฏ ูู ูโุชููุฏ ุชุณุช ฺฉูุฏ ุชุง ูุทูุฆู ุจุดุฏ ฺฉู ุจุฏูู ฺฉุฑุฏูุดุงู ุงูฺฉุงู ุงุชุตุงู ุจูุด ูุฌูุฏ ูุฏุงุฑู):</p>

<p><img src="/assets/img/post/2019-04-19/secure-mongo-6.png" alt="secure-mongo-6" /></p>

<p>ู ุชููุงุงุงุงุงู๐ง</p>

<p><img src="/assets/img/post/2019-04-19/secure-mongo-7.gif" alt="secure-mongo-7" /></p>

<h3 id="ุฑุงู-ุณุงุฏูุชุฑ">ุฑุงู ุณุงุฏูโุชุฑ</h3>

<p>ููฺฉูู ุจูพุฑุณู ุฑุงู ุณุงุฏูโุชุฑ ูู ูุณุชุ</p>

<p>ุจุงุฏ ุจฺฏู ฺฉู ุฑุงูโูุง ูุฎุชูู ุฑู ุชุณุช ฺฉุฑุฏูุ ูู ุจูุชุฑู ู ูุทูุฆูโุชุฑู ุฑุงู (ฺฉู ูุงุฑุบ ุงุฒ ูุฑฺู ูููฺฏู ุฏุงฺฉุฑ ู ูููฺฏูุฒ ุจุงุดู) ููู ุฑุงู ุจูุฏ ฺฉู ุจูุชูู ฺฏูุชู. ููุชู ุฎูุฏ ูููฺฏู ู ุฑุงู ุฏฺฏู ุจุฑุง ุชุนุฑู ฺฉุงุฑุจุฑ ุฏุฑ ููฺฏุงู ุงุฌุฑุง ฺฏูุชู ฺฉู ูุชุงุณูุงูู ูู ูุฑููุช ุงุฌุฑุง ฺฉุฑุฏู ูุชููุณุชู ุจู ุฏุชุงุจุณ ูุตู ุดู ู ูุฏุงู ุฎุทุง  <code class="highlighter-rouge">uthenticaiton failed</code> ูฺฏุฑูุชู. ุฎุจุ ุฑุงู ฺฉู ูููฺฏู ูพุดููุงุฏ ูุฏู ุงูู:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>docker run -d --network some-network --name some-mongo <span class="se">\</span>
    -e <span class="nv">MONGO_INITDB_ROOT_USERNAME</span><span class="o">=</span>mongoadmin <span class="se">\</span>
    -e <span class="nv">MONGO_INITDB_ROOT_PASSWORD</span><span class="o">=</span>secret <span class="se">\</span>
    mongo

<span class="gp">$ </span>docker run -it --rm --network some-network mongo <span class="se">\</span>
    mongo --host some-mongo <span class="se">\</span>
        -u mongoadmin <span class="se">\</span>
        -p secret <span class="se">\</span>
        --authenticationDatabase admin <span class="se">\</span>
        some-db
<span class="gp">&gt; </span>db.getName<span class="o">()</span>;
some-db
</code></pre>
</div>

<p>ููููู ูุดู ุชุณุช ฺฉูุฏ ู ุงฺฏู ุจู ุฌูุงุจ ุฑุณุฏุฏ ุชู ฺฉุงููุชุง ูุชุฌูโุชูู ุฑู ุงุนูุงู ฺฉูุฏ.</p>

<h2 id="ููุงุจุน-ุจุฑุง-ูุทุงูุนู-ุจุดุชุฑ">ููุงุจุน ุจุฑุง ูุทุงูุนู ุจุดุชุฑ</h2>

<p>ุงฺฏู ุฏูุณ ุฏุงุฑู ุฏุฑ ููุฑุฏ ุงููุช ูููฺฏู ู ุญูุธ ุงุทูุงุนุงุชุชูู ุจุดุชุฑ ุจุฏููุฏ ุชุง ูโุชููุฏ ููฺฉโูุง ุฒุฑ ุฑู ูุทุงูุนู ฺฉูุฏ:</p>

<ul>
  <li>ูพุงุจูุดุฑ <a href="https://medium.com/mongoaudit">mongoaudit</a> ฺฉู ููุงูู ุฎูุจ ู ููุฏ ุฏุฑุจุงุฑู ุงููุช ูููฺฏู ุฏุงุฑู</li>
  <li>ุงููุช ุฏุฑ ุฏุชุงุจุณ ูููฺฏู ูุณุช: <a href="https://docs.mongodb.com/manual/security/">ููฺฉ ฑ</a>ุ <a href="https://docs.mongodb.com/manual/administration/security-checklist/">ููฺฉ ฒ</a>ุ <a href="https://medium.com/@matteocontrini/how-to-setup-auth-in-mongodb-3-0-properly-86b60aeef7e8">ููฺฉ ณ</a>ุ <a href="https://medium.com/@htayyar/mongodb-security-checklist-9938cc5f07c9">ฺฺฉ ูุณุช</a> ุงููุช ูููฺฏู ฺฉู ุจุงุฏ ุฑุนุงุช ุจุดู</li>
  <li>ุณุทูุญ ฺฉุงุฑุจุฑ ู ุงุตููุง ฺฉุงุฑ ฺฉุฑุฏู ุจุง ฺฉุงุฑุจุฑ: <a href="https://docs.mongodb.com/manual/core/security-users/">ููฺฉ ุง</a>ุ <a href="https://docs.mongodb.com/manual/tutorial/manage-users-and-roles/">ููฺฉ ฒ</a></li>
  <li>ุงููุช ุฏุฑ ูููฺฏู ุฏุงฺฉุฑ: <a href="https://medium.com/@MaxouMask/secured-mongodb-container-6b602ef67885">ููฺฉ ฑ</a></li>
  <li>ูุงุฑูุงูโูุง ุฏุฑ ููฺฉูุณ: <a href="https://www.cyberciti.biz/faq/how-to-setup-a-ufw-firewall-on-ubuntu-18-04-lts-server/">ููฺฉฑ</a>ุ <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-18-04">ููฺฉ ฒ</a></li>
</ul>

<h2 id="ุฌูุน-ุจูุฏ">ุฌูุน ุจูุฏ</h2>

<p>ุงู ูพุณุช ุฌูุน ุจูุฏ ุฎุงุต ูุฏุงุฑูุ ุฌุฒ ุงูฺฉู ููุงุณุชูู ุจุงุดู ูพูุฑุชโูุงุชูู ุฑู ุจ ุฏูู ุจุงุฒ ูฺฏุฐุงุฑุฏ ๐คฆโโ๏ธ ู ุฏุชุงุจุณ ุจุง ุงุทูุงุนุงุช ููู ุฑู ุฑู ุชูุธูุงุช ูพุดูุฑุถ ุจุงูุง ูุงุฑู! ุญุชูุง ููุงุฑุฏ ุงููุช ุฑู ุฑุนุงุช ฺฉุฑุฏู ู ฺฉุฑุฏูุดุงูโูุง ุฑู ุงุนูุงู ฺฉูุฏ.</p>

<p>ูุทูุง ุงฺฏู ุฑุงู ุจูุชุฑ ุง ุฑูุดโูุง ุฏฺฏูโุง ุจูุฏูุ ุฏุฑ ฺฉุงููุชโูุง ุจุง ุจูู ุจู ุงุดุชุฑุงฺฉ ุจฺฏุฐุงุฑู ๐</p>

<p>ุงฺฏู ุณูุงู ุง ููุฑุฏ ุจูุฏุ ูุซู ููุดู ุฏุฑ ุชูุชุฑ ุง ุฏุฑ ุชูฺฏุฑุงู ูุชููู ุจุงูู ุฏุฑ ุงุฑุชุจุงุท ุจุงุดู. ๐๐ท</p>

        </div>


        <div class="post-routes-list">
            
            <a class="category-link" href="/category/mongo">Mongo</a>
            
            <a class="category-link" href="/category/database">Database</a>
            
            <a class="category-link" href="/category/docker">Docker</a>
            
            
            <a class="tag-link" href="/tag/mongo">Mongo</a>
            
            <a class="tag-link" href="/tag/nodejs">NodeJs</a>
            
            <a class="tag-link" href="/tag/mongoose">Mongoose</a>
            
            <a class="tag-link" href="/tag/security">Security</a>
            
            <a class="tag-link" href="/tag/docker">Docker</a>
            
            <a class="tag-link" href="/tag/ุฏุงฺฉุฑ">ุฏุงฺฉุฑ</a>
            
        </div>


        <div class="Prev-next-post-container">
            
            <a class="previous-btn" href="/2018/solid">ููุดุชู ูุจู: ุงุตูู ต ฺฏุงูู SOLID - ููุฏูุงุช โ</a>
            
            
            <a class="next-btn" href="/2019/markdown-like-the-zeus">โ ููุดุชู ุจุนุฏ: ูุซู ุฒุฆูุณ ูุงุฑฺฉุฏุงูู ุจููุณู</a>
            
        </div>

        <div class="commets-delimiter-space"></div>
        <div class="commets-delimiter">
            <span></span>
        </div>

        <script
                data-isso-vote="true"
                data-isso-avatar="true"
                data-isso="https://isso.isapanah.com/"
                data-isso-lang="ru"
                src="https://isapanah.com/assets/js/embed.min.js"></script>

        <section id="isso-thread">
        </section>

    </div>

</div>

<a id="back-to-top" class="back-to-top" role="button" title="Click to return on the top page" data-toggle="tooltip" data-placement="left" onclick="topFunction()">
    <img src="/assets/img/base/arrow-up.png" class="arrow-up"/>
</a>


        <!-- Footer -->
<footer class="footer-wrapper">

    <div class="delimiter">
        <a href="/" class="footer-logo">
            <img src="https://isapanah.com/assets/img/base/favicon.png" class="logo-wrapper">
        </a>
    </div>

    <p class="footer-copyright">
        2008 - 2017<br>
        ูุทุงูุจ ุชุญุช ูุณุงูุณ <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/" rel="license" target="_blank">ฺฉุฑุชู ฺฉุงููุฒ</a> ููุชุดุฑ ูโุดููุฏ.

    </p>

    <div class="footer-social-links">
        <a href="https://twitter.com/sadra-amlashi" title="Twitter" target="_blank"><i class="fa fa-twitter"></i></a>
        <a href="https://github.com/sadra" title="Github" target="_blank"><i class="fa fa-github"></i></a>
        <a href="https://medium.com/sadra" title="Medium" target="_blank"><i class="fa fa-medium"></i></a>
        <a href="https://www.linkedin.com/in/amlashisadra/" title="Linkedin" target="_blank"><i class="fa fa-linkedin"></i></a>
        <a href="https://facebook.com/sadra.am123" title="Facebook" target="_blank"><i class="fa fa-facebook"></i></a>
    </div>


 </footer>
<!-- /Footer -->

        
    </body>
</html>
